define(["tracker_ref_yhd.global_spm"],function(e){var g={};var f=$("html"),l=$(".filter_layer"),k=$(".touchweb-com_header"),q=$(".touchweb_com-searchMod"),d=$(".touchweb_components-searchList"),j=$(".pole_layout"),b=k.find(".search_txt"),c=$(".touchweb_components-searchList ul"),n=q.height();var i=URLPrefix.search||"http://m.yhd.com";Array.prototype.unique=function(){var s={};var r=this.length;for(var t=0;t<r;t++){if(typeof s[this[t]]=="undefined"){s[this[t]]=1}}this.length=0;for(var t in s){this[this.length]=t}return this};function h(){m();var r=localStorage.getItem("historykeyword")||"";if(!r){d.removeClass("show");d.find(".clear_history").hide()}else{d.addClass("show");d.find(".clear_history").show()}}function a(){var r=b.val();if(!r){return}$.ajax({url:i+"/search/getkeyword/"+r,dataType:"jsonp",jsonpCallback:"jsonp"+new Date().getTime(),success:function(x){var s="";
if(x!=null&&x!=""){var v=x.split(";");var w=v.length>6?6:v.length;for(var u=0;u<w;u++){var t=v[u].split(",")[0];s+='<li ><a href="javascript:;"><span style="display: inline-block;padding-left: 5px;">'+t+"</span></a></li>"}c.html(s)}else{s+='<li data-result="empt"><a  href="javascript:;"><span style="display: inline-block;padding-left: 5px;"> 没有搜索内容 </span></a></li>';c.html(s)}},error:function(){var s="";s+='<li data-result="empt"><a  href="javascript:;"><span style="display: inline-block;padding-left: 5px;"> 没有搜索内容 </span></a></li>';c.html(s)}})}function m(){var r="",t="";if(!localStorage.getItem("historykeyword")){c.html("");return}else{t=localStorage.getItem("historykeyword").split("|");if(t.length>0){c.empty();var u=t.length>6?6:t.length;for(var s=0;s<u;s++){r+='<li><a class="icon-history"><span style="display: inline-block;padding-left: 5px;">'+t[s]+"</span></a></li>"
}c.html(r)}}}function p(t){var r=localStorage.getItem("historykeyword")||"";var s=[];if(r){s=r.split("|");s=s.reverse()}s[s.length]=t;s=s.reverse();s=s.unique();if(s.length>6){s.length=6}localStorage.setItem("historykeyword",s.join("|"))}function o(r){p(r);var s=(URLPrefix.search||"http://m.yhd.com")+"/search/k"+r;e.refreshPage(s,$("#searchBox"))}g.init=function(){j.css("height",n);b.on("focus",function(){f.addClass("win_lock");q.addClass("show");h()});b.on("input",function(){if(this.value){d.addClass("show");a();d.find(".clear_history").hide()}else{h()}});l.on("click",function(){f.removeClass("win_lock");d.removeClass("show");q.removeClass("show")});d.on("click","li",function(){var r=$(this).text().trim();if(r==="没有搜索内容"){return}k.find(".search_txt").val(r.replace(/(^\s*)|(\s*$)/g,""));p(r);
f.removeClass("win_lock");d.removeClass("show");q.removeClass("show");addTrackPositionToCookie("1","search");o(r)});d.on("click",".clear_history",function(){localStorage.removeItem("historykeyword");d.find("ul").empty();m();d.removeClass("show")});$("#searchForm_id").bind("submit",function(){var r=b.val().replace(/(^\s*)|(\s*$)/g,"");o(r);return false})};return g});