define(["global_env","tracker_ref_yhd.global_spm","common_redirect"],function(i,d,j){var f={};var c=i.isInApp();var h="_landingpage";var b=i.getOSType();var k=i.isWireless2();var m=function(){};var a=function(){f.refreshCart()};var e=URLPrefix.index||"http://m.yhd.com";var n=function(o){};var l=function(q,p,o){};var g=function(s,o){if(k){var r={};if(s){var q=d.getData(s,o);if(q){r.tp=q.tp;r.tc=q.tc}}j.gotoWireless2Login(r)}else{var p=globalLoginUrl;if(c){p=e+"/mw/login"}if(i.adapterNewListenner()){d.refreshPage(p,s,o)}else{document.location=p}}};f.addToCart=function(v,u){if(typeof u!="undefined"&&u){if(u.befourAddToCart){m=u.befourAddToCart}if(u.addToCartSuccess){a=u.addToCartSuccess}if(u.addToCartError){n=u.addToCartError}if(u.addToCartServerError){l=u.addToCartServerError}if(u.needLogin){g=u.needLogin
}}if(i.isWireless2()){f.wireless2AddToCart(v);return}var C=v.pmId||0;var B=v.productId||0;var x=v.promotionId||"0";var s=v.promotionId||0;var E=v.promotionLevelId||0;var o=v.merchantId||0;var D=v.needpoint||0;var y=v.productType||0;var w=v.num||1;var r=v.showPrice;var H=v.needTip;var G=v.dom;var K=v.tag;var q=v.opType||1;if($.trim(x)!=""&&x!="null"&&x!="0"&&!URLPrefix.cart){x=x+"_0"+h}if(typeof x=="undefined"||$.trim(x)==""||x=="null"){x="0";s="0"}if(typeof o=="undefined"||$.trim(o)==""||o=="null"){o="0"}if($.trim(y)!=null&&(y==2||y==1)){var t="";if(b==40){t=websiteurl+"/buypro/"+B+"_"+o+"_1_"+x+"_1";t+="?pmId="+C;document.location=t}else{if(c){j.productDetail(C,B,s||0,G,K)}else{j.productDetail(C,B,s||0,G,K)}}}else{if(c){var t=websiteurl+"/buypro/"+B+"_"+o+"_1_"+x+"_0";t=t+"?pmId="+C;if(i.adapterNewListenner()){d.refreshPage(t,G,K)
}else{document.location=t}}else{if(URLPrefix.cart){var A="";var I={};var z=URLPrefix.cart;if(r){I.showPrice=r}if(H){I.needTip=H}if(x!="0"){A=z+"/cart/addPromotion";I={opTypes:q,promotionIds:x,promotionLevelIds:E,merchantIds:o,pmids:C,nums:w}}else{if(D>0){A=z+"/cart/addPoint";I={pmId:C,num:w}}else{A=z+"/cart/addNormalPmInfo";I={pmId:C,num:w}}}var J=($.param(I,true));A=A+"?"+J;$.ajax({url:A,dataType:"jsonp",jsonpCallback:"jsonp"+new Date().getTime(),success:function(M){if(M&&M.code!="00000000"){if(M.msg&&M.msg.indexOf("登录")>=0){g(G,K)}else{n(M.msg)}return}if(M&&M.data){var L=M.data;if(M.data instanceof Array&&M.data.length>0){L=M.data[0]}if(L.rtnCode!="000000"){if(L.rtnMsg.indexOf("登录")>=0||L.rtnMsg.indexOf("登陆")>=0){g(G,K)}else{n(L.rtnMsg)}}else{a()}}else{n()}},error:function(N,M,L){l(N,M,L)
}})}else{var p=new Date().getTime();var F="";if(x=="0"){F="/deal/cart/buyproduct/"+C+"/"+w+"?now="+p+"&needpoint="+D}else{F="/deal/cart/buyproduct/"+C+"/"+o+"/"+w+"/"+x+"?now="+p+"&needpoint="+D}if(r){F+="&showPrice="+r}if(H){F+="&needTip="+H}$.ajax({type:"POST",url:F,data:"",dataType:"json",success:function(M){if(M&&M.message){var L=M.message;if(L=="添加购物车成功!"){a()}else{if(L.indexOf("登录")>0||L.indexOf("登陆")>0){g(G,K)}else{n(L)}}}else{n()}}})}}}};f.refreshCart=function(){if(URLPrefix.cart){$.ajax({url:URLPrefix.cart+"/cart/countCart",dataType:"jsonp",jsonpCallback:"jsonp"+new Date().getTime(),success:function(p){if(p&&p.code=="00000000"&&p.data&&p.data.resultData){var o=p.data.resultData.num||0;if(o!="0"){$("#globalCart").html("<i class='sumClass'>"+o+"</i>").show();$("#carId").text(o).show();
$("#globalId").text(o).show()}else{$("#globalCart i").hide();$("#carId").hide();$("#globalId").hide()}}}})}else{$.ajax({type:"POST",url:"/mw/carCounts",success:function(o){if(o){if(o!="0"){$("#globalCart").html("<i class='sumClass'>"+o+"</i>").show();$("#carId").text(o).show();$("#globalId").text(o).show()}else{$("#globalCart i").hide();$("#carId").hide();$("#globalId").hide()}}}})}};f.wireless2AddToCart=function(s){var z=s.pmId||0;var y=s.productId||0;var u=s.promotionId||0;var p=s.merchantId||0;var w=s.productType||0;var t=s.num||1;var D=s.dom;var G=s.tag;var q=1;var r=s.opType;var B=s.promotionLevelId;var o=s.pmIdStr;var A=s.needpoint||0;if($.trim(w)!=null&&(w==2||w==1)){j.productDetail(z,y,u||0,D,G)}else{var F={};if(u&&u!="0"){q=3}else{if(A&&A!="0"){q=2}}F.addType=q+"";if(q==1||q==2){F.pmId=z;
F.num=t+""}else{if(q==3){F.opType=r;F.promotionId=u;F.promotionLevelId=B;F.merchantId=p+"";try{if(!o){var x={};x[z]=parseInt(t);F.pmIdStr=x}else{F.pmIdStr=o}}catch(E){}}}if(D){var C=d.getData(D,G);if(C){F.tp=C.tp;F.tc=C.tc}}var v=h5tonative;if(F&&typeof F!="string"){F=JSON.stringify(F);v.addCart(F)}}};return f});