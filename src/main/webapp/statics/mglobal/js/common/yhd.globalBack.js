define("common_back",["tracker_ref_yhd.global_spm","common_yhd.storage"],function(m,i){var g={};var a=window.loli||(window.loli={});var p=a.app=a.app||{};var k=a.app.url=a.app.url||{};var e=a.yhdSessionStore;var o=a.app.url.cfg=a.app.url.cfg||{enable:true,type:"url",maxSize:100};var c=function(){var t="user_browse_history";if(window.name==""){window.name=new Date().getTime()}return t+"_"+window.name};var f=c();var b=function(t){e.getFromRoot(f,function(w){var u=null;if(w&&w.status==1){var v=w.value;u=(v!=null&&v!="")?$.parseJSON(v):null}t(u)})};var l=function(u,t){var v=u?JSON.stringify(u):"";e.setFromRoot(f,v,function(w){if(t){t(w)}})};var r=function(z){var w="";var B="";var u="";var x="";var A=/^(http[s]?:\/\/[\.\w]*\.yhd\.com)[\/]?/i;var v=/^http[s]?:\/\/[\.\w]*\.yhd\.com(\/[^\?]*\/?)[\?\#]*/i;
var y=/(\?[^\#]*)/i;var t=/(\#.*)/i;if(A.test(z)){w=A.exec(z)[1]}if(v.test(z)){B=v.exec(z)[1]}if(y.test(z)){u=y.exec(z)[1]}if(t.test(z)){x=t.exec(z)[1]}return{domain:w,path:B,params:u,hash:x}};var q=function(t,u){var x=new RegExp("[?&]"+u+"=[^&#]*");var w=t;if(x.test(t)){var v=x.exec(t)[0];if(v.charAt(0)=="?"){w=t.replace(x,"?")}else{w=t.replace(x,"")}if(w.indexOf("?&")!=-1){w=w.substring(0,w.indexOf("?&")+1)+w.substring(w.indexOf("?&")+2)}if(w.charAt(w.length-1)=="?"){w=w.substring(0,w.length-1)}}return w};var d=function(v){var u=/(\#.*)/i;var t=v;if(u.test(v)){t=v.replace(u,"")}return t};var n=function(u){var t=q(u,"tp");t=q(t,"tc");t=q(t,"tce");return t};var s=function(E,w){var z=window.user_browse_history;var t=n(document.location.href);var y=-1;if(z&&z.data&&z.data.length>0){if(E=="url"){if(w){for(var B=z.index-1;
B>=0;B--){var u=d(n(z.data[B]));if(u&&w==u){y=B-z.index;break}}}else{var D=d(n(t));var C=false;for(var B=z.index-1;B>=0;B--){var u=d(n(z.data[B]));if(u&&D!=u){y=B-z.index;C=true;break}}if(!C){if(window.history.length>z.data.length){y=0-(z.index+1)}}}}else{if(E=="path"){if(w){for(var B=z.index-1;B>=0;B--){var u=n(z.data[B]);if(u){var A=r(u);if(A.path==w){y=B-z.index;break}}}}else{var v=r(t).path;var C=false;for(var B=z.index-1;B>=0;B--){var u=n(z.data[B]);if(u){var A=r(u);if(A.path!=v){y=B-z.index;C=true;break}}}if(!C){if(window.history.length>z.data.length){y=0-(z.index+1)}}}}else{if(E=="domain"){if(w){for(var B=z.index-1;B>=0;B--){var u=n(z.data[B]);if(u){var A=r(u);if(A.domain==w){y=B-z.index;break}}}}else{var x=r(t).domain;var C=false;for(var B=z.index-1;B>=0;B--){var u=n(z.data[B]);if(u){var A=r(u);
if(A.domain!=x){y=B-z.index;C=true;break}}}if(!C){if(window.history.length>z.data.length){y=0-(z.index+1)}}}}else{if(w){for(var B=z.index-1;B>=0;B--){var u=n(z.data[B]);if(u&&w==u){y=B-z.index;break}}}else{y=-1}}}}}return y};var h=function(u,v){var y=window.user_browse_history!=null?window.user_browse_history:{data:[],index:-1,timestamp:0};var w=document.location.href;if(!u){return}if(u==1){if(y.data&&y.data.length>0){var x=y.data[y.index];if(x==w){return}}if(y.data&&y.data.length>0&&y.index>-1){if(y.data.length-1>=y.index+1){y.data.splice(y.index+1)}}y.data.push(w);y.index=y.index+1}else{if(u==2){y={data:[],index:-1};y.data.push(w);y.index=y.index+1}else{if(u==3){if(y.index!=-1){y.index=y.index-1}}else{if(u==4){if(y.index!=-1){y.index=y.index+1}}else{if(u==5){if(v!=-1){y.index=v}}}}}}var t=y.data.length-o.maxSize;
if(t>0&&y.index>=t){y.data.splice(0,t);y.index=y.index-t}y.timestamp=new Date().getTime();y.historyLength=window.history.length;l(y,function(){window.user_browse_history=y})};var j=function(x){var y=document.location.href;var t=0;var u=-1;if(x&&x.data&&x.data.length>0&&x.index>-1){var z=x.data[x.index-1];var A=x.data[x.index+1];if(y==z){t=3}else{if(y==A){t=4}else{t=5;for(var w=x.index-1;w>=0;w--){var v=x.data[w];if(v==y){u=w;break}}if(u==-1){for(var w=x.index;w<x.data.length;w++){var v=x.data[w];if(v==y){u=w;break}}}if(u==-1){t=2}}}}else{t=2}return{flag:t,curIndex:u}};k.saveURL=function(){var u=document.referrer;var t=document.location.href;if(window.user_browse_history){return}b(function(w){window.user_browse_history=w;var v=0;var x=-1;if(!w||!w.data||w.data.length==0){v=2;h(v);return}var z=window.performance.navigation.type;
if(z==0){if(w&&w.data&&w.data.length>0){var y=w.data[w.index];if(u==""){if(window.history.length-1>w.historyLength){v=2}else{v=1}}else{if(u==y||u==d(y)){v=1}else{v=2}}}else{v=2}}else{if(z==1){v=0;if(w&&w.data&&w.data.length>0){var y=w.data[w.index];if(y!=t){v=2}}else{v=2}}else{if(z==2){var A=j(w);v=A.flag;x=A.curIndex}else{v=1}}}if(v){h(v,x)}})};k.saveAnchor=function(){var t=window.history.length;var u=window.history.state;window.onpopstate=function(x){var A=x||window.event;var y=document.location.href;var v=0;var B=-1;var z=function(E){if(!E||!E.data||E.data.length==0){v=2;h(v);return}if(E.data&&E.data.length>0){var C=E.data[E.index];if(C==y){return}}if(E&&E.data&&E.data.length>0&&E.index>-1){var C=E.data[E.index];if(d(y)!=d(C)){var F=j(E);v=F.flag;B=F.curIndex;h(v,B);return}}if(t==window.history.length){var D=window.history.state;
if(D==null&&u!=null){v=3}else{if(D!=null&&u!=null){if(D.timestamp<=u.timestamp){v=3}else{v=4}}else{if(D!=null&&u==null){v=4}else{v=0}}}}else{var G=new Date().getTime();window.history.replaceState({timestamp:G},"",document.location.hash);v=1}t=window.history.length;u=window.history.state;if(v){h(v,B)}};var w=window.user_browse_history;if(w){z(w)}else{b(z)}}};k.goBack=function(v,u){var t=v?v:o.type;var w=s(t,u);window.history.go(w)};k.isHTML5=function(){if(window.performance&&window.history.replaceState&&window.sessionStorage&&window.postMessage){return true}return false};g.saveURL=function(){if(a.app.url.isHTML5()){a.app.url.saveURL();a.app.url.saveAnchor()}};g.init=function(t){if(t){o=$.extend(o,t)}if(!o.enable){return}if(a.app.url.isHTML5()){$("#topIconBack").attr("href","javascript:void(0);");
$("#topIconBack").off().on("click",function(){a.app.url.goBack()})}};return g});