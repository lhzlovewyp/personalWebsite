define(function(){function d(k,e,g){var h;if(!g){h=function(){return true}}else{h=function(m,l){return m.hasOwnProperty(l)}}if(k!=null&&e!=null){var i,j,f;for(f in k){if(k.hasOwnProperty(f)){j=k[f];if(e===j){continue}if(j!==undefined&&h(e,f)){e[f]=j}}}return e}}function c(f){var e=function(){};e.prototype=f;return new e()}function a(g){var e={element:false,start:false,dbclick:false,click:false,move:false,hover:false,end:false,sliceEnd:false,startZoom:false,zoom:false,gesture:false,prevent:false,userSelect:false,stopPropagation:true};var f=c(b);d(g,e,true);d(e,f);f.init();return f}var b={init:function(){if(!this.element){return false}this.errorRange=10;this.holdon=1000;this.clickRecord=[];this.offset=this.getOffset(this.element);if(this.userSelect){this.element.style.mozUserSelect="none";this.element.style.webkitUserSelect="none";
this.element.onselectstart=function(){return false}}var e=!!("ontouchstart" in window);if(e){this.bindtouchEvents()}else{this.bindclickEvents()}},bindtouchEvents:function(){var e=this;var f=this.element;f.addEventListener("touchstart",function(i){if(i.target.nodeName==="INPUT"){return}e.startEv=e.startEv||{};e.offset=e.getOffset(e.element);e.startEv.time=e.getTime();e.startEv.points=[];for(var k=0;k<i.targetTouches.length;k++){var g={};g.x=i.targetTouches[k].pageX;g.y=i.targetTouches[k].pageY;e.startEv.points.push(g)}if(e.startEv.points.length===1){var h=e.startEv.points[0];var j={x:h.x-e.offset.left,y:h.y-e.offset.top};e.start&&e.start.apply(e.element,[i,j.x,j.y])}else{if(e.startEv.points.length===2){e.startZoom&&e.startZoom.apply(null)}}if(e.stopPropagation){i.stopPropagation();i.preventDefault()
}},false);f.addEventListener("touchmove",function(m){if(!e.startEv){return false}if(e.stopPropagation){m.stopPropagation()}if(e.startEv.points.length>1){if(e.stopPropagation){m.preventDefault()}if(e.startEv.points.length===2){var i=e.offset.left;var o=e.offset.top;var u={x:e.startEv.points[0].x-i,y:e.startEv.points[0].y-o};var r={x:e.startEv.points[1].x-i,y:e.startEv.points[1].y-o};var n={x:m.targetTouches[0].pageX-i,y:m.targetTouches[0].pageY-o};var l={x:m.targetTouches[1].pageX-i,y:m.targetTouches[1].pageY-o};e.zoom&&e.zoom.apply(null,[m,u,r,n,l])}return false}else{e.moveEv=e.moveEv||{};e.moveLists=e.moveLists||[];var p={};p.x=m.targetTouches[0].pageX;p.y=m.targetTouches[0].pageY;if(!e.moveEv.angle){var g=e.startEv.points[0];var j=e.getAngle(g.x,p.x,g.y,p.y);if(!!e.prevent&&e.stopPropagation){switch(e.prevent){case"x":if(Math.abs(j)<20||Math.abs(j)>160){m.preventDefault()
}break;case"y":if(Math.abs(j)>70&&Math.abs(j)<110){m.preventDefault()}break;case"all":m.preventDefault();break}}if((j>-45)&&(j<=45)){e.moveEv.dir="lr"}if((j>135)||(j<=-135)){e.moveEv.dir="rl"}if((j>45)&&(j<=135)){e.moveEv.dir="ud"}if((j>-135)&&(j<=-45)){e.moveEv.dir="du"}e.moveEv.angle=j}var v=e.getTime();if(e.moveEv.last){var h=Math.sqrt(Math.pow(Math.abs(p.x-e.moveEv.last.x),2)+Math.pow(Math.abs(p.y-e.moveEv.last.y),2));e.speed=h/(v-e.moveEv.last.time);e.moveEv.last.time=v;e.moveEv.last.x=p.x;e.moveEv.last.y=p.y}else{e.moveEv.last={};e.moveEv.last.time=v;e.moveEv.last.x=p.x;e.moveEv.last.y=p.y}var s=p.x-e.startEv.points[0].x;var q=p.y-e.startEv.points[0].y;var k={x:p.x-e.offset.left,y:p.y-e.offset.top};e.move&&e.move.apply(f,[m,e.moveEv.dir,s,q,k.x,k.y]);e.moveLists.push({t:v,x:p.x,y:p.y})
}},false);f.addEventListener("touchend",function(n){e.end&&e.end.apply(e.element,[]);if(!e.startEv){return false}if(e.stopPropagation){n.stopPropagation()}var k=e.startEv.points[0];var j=e.getTime();if(!e.moveEv||Math.abs(e.moveEv.last.x-k.x)<e.errorRange&&Math.abs(e.moveEv.last.y-k.y)<e.errorRange){if(j-e.startEv.time<e.holdon){e.click&&e.click.apply(e.element,[n,k.x-e.offset.left,k.y-e.offset.top]);if(e.clickRecord.length>=1){var m=e.clickRecord[e.clickRecord.length-1];if(j-m.time<500&&Math.abs(k.x-m.x)<e.errorRange&&Math.abs(k.y-m.y)<e.errorRange){e.dbclick&&e.dbclick.apply(e.element,[n,k.x-e.offset.left,k.y-e.offset.top]);e.clickRecord=[]}}e.clickRecord.push({time:j,x:k.x,y:k.y})}}else{var l=e.moveLists.length;if(l>2){var h=e.moveLists[l-1];var g=e.moveLists[l-2];var i={};i.x=(h.x-g.x)/(h.t-g.t);
i.y=(h.y-g.y)/(h.t-g.t);e.sliceEnd&&e.sliceEnd.apply(e.element,[i])}else{}}e.startEv=null;e.moveEv=null;e.moveLists=[];if(e.stopPropagation){n.stopPropagation();n.preventDefault()}},false)},bindclickEvents:function(){var e=this,f=this.element,g=document;this.addHandler(f,"mousedown",function(i){if(i.button!==0){return false}e.startEv=e.startEv||{};e.offset=e.getOffset(e.element);e.startEv.time=e.getTime();e.startEv.points=[];var h={};if(i.pageX||i.pageY){h.x=i.pageX;h.y=i.pageY}else{h.x=i.clientX+g.body.scrollLeft+g.documentElement.scrollLeft;h.y=i.clientY+g.body.scrollTop+g.documentElement.scrollTop}e.startEv.points.push(h);var j={x:h.x-e.offset.left,y:h.y-e.offset.top};e.start&&e.start.apply(e.element,[i,j.x,j.y])},false);this.addHandler(f,"mousemove",function(m){if(!e.startEv){return false
}e.moveEv=e.moveEv||{};e.moveLists=e.moveLists||[];var h={};if(m.pageX||m.pageY){h.x=m.pageX;h.y=m.pageY}else{h.x=m.clientX+g.body.scrollLeft+g.documentElement.scrollLeft;h.y=m.clientY+g.body.scrollTop+g.documentElement.scrollTop}if(!e.moveEv.angle){var l=e.startEv.points[0];var n=e.getAngle(l.x,h.x,l.y,h.y);if((n>-45)&&(n<=45)){e.moveEv.dir="lr"}if((n>135)||(n<=-135)){e.moveEv.dir="rl"}if((n>45)&&(n<=135)){e.moveEv.dir="ud"}if((n>-135)&&(n<=-45)){e.moveEv.dir="du"}e.moveEv.angle=n}var k=e.getTime();e.moveEv.last=e.moveEv.last||{};e.moveEv.last.time=k;e.moveEv.last.x=h.x;e.moveEv.last.y=h.y;var j=h.x-e.startEv.points[0].x;var i=h.y-e.startEv.points[0].y;var o={x:h.x-e.offset.left,y:h.y-e.offset.top};e.move&&e.move.apply(f,[m,e.moveEv.dir,j,i,o.x,o.y]);e.moveLists.push({t:k,x:h.x,y:h.y})});this.addHandler(f,"mouseup",function(o){e.end&&e.end.apply(e.element,[]);
if(!e.startEv){return false}var l=e.startEv.points[0];var k=e.getTime();if(!e.moveEv||Math.abs(e.moveEv.last.x-l.x)<e.errorRange&&Math.abs(e.moveEv.last.y-l.y)<e.errorRange){if(k-e.startEv.time<e.holdon){e.click&&e.click.apply(e.element,[o,l.x-e.offset.left,l.y-e.offset.top]);if(e.clickRecord.length>=1){var n=e.clickRecord[e.clickRecord.length-1];if(k-n.time<500&&Math.abs(l.x-n.x)<e.errorRange&&Math.abs(l.y-n.y)<e.errorRange){e.dbclick&&e.dbclick.apply(e.element,[l.x-e.offset.left,l.y-e.offset.top]);e.clickRecord=[]}}e.clickRecord.push({time:k,x:l.x,y:l.y})}}else{var m=e.moveLists.length;if(m>2){var i=e.moveLists[m-1];var h=e.moveLists[m-2];var j={};j.x=(i.x-h.x)/(i.t-h.t);j.y=(i.y-h.y)/(i.t-h.t);e.sliceEnd&&e.sliceEnd.apply(e.element,[j])}else{}}e.startEv=null;e.moveEv=null;e.moveLists=[]});
this.addHandler(f,"mouseout",function(h){if(e.checkHover(h,this)){e.startEv=null;e.moveEv=null;e.moveLists=[]}})},checkHover:function(g,f){if(g.type=="mouseover"){return !this.contains(f,g.relatedTarget||g.fromElement)&&!((g.relatedTarget||g.fromElement)===f)}else{return !this.contains(f,g.relatedTarget||g.toElement)&&!((g.relatedTarget||g.toElement)===f)}},contains:function(e,f){return e.contains?e!=f&&e.contains(f):!!(e.compareDocumentPosition(f)&16)},addHandler:function(g,f,e){if(g.addEventListener){g.addEventListener(f,e,false)}else{if(g.attachEvent){g.attachEvent("on"+f,e)}}},getTime:function(){return new Date().getTime()},getAngle:function(g,f,i,h){this.pi=this.pi||Math.PI;var e=f-g;var k=h-i;var j=Math.atan2(k,e)*180/this.pi;return j},getOffset:function(h){var f=h.offsetTop;var e=h.offsetLeft;
if(h.offsetParent!=null){var g=this.getOffset(h.offsetParent);f+=g.top;e+=g.left}return{top:f,left:e}}};return a});