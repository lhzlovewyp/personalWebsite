define(["common_yhd.storage","util_globalLogin"],function(h,f){var a=null;var e="http://m.yhd.com/mobile/nearShop/index.do";var b={};function i(){h.getFromRoot("pminfoRay",function(l){if(l&&l.value){var k=JSON.parse(l.value);if(k){var j=d(k);if(j.length>0){c(JSON.stringify(j));return}}}alert("选择商品数量为0，不能结算");document.location=e})}function d(l){var j=[];for(var k=0;k<l.length;k++){if(l[k].num){j.push(l[k])}}return j}var g=function(j){if(j.result==1){i()}else{alert("进入登录");document.location="https://passport.yhd.com/m/login_input.do"}};function c(k){var m="pminfo="+k+"&virtualprovinceid="+a;var l="http://cart.m.yhd.com/cart/fastBuyBatch?mobileBizType=5";var j="http://buy.m.yhd.com/checkout/order.do?mobileBizType=5&fastBuyFlag=1&virtualprovinceid="+a;$.ajax({url:l,dataType:"jsonp",data:m,jsonpCallback:"jsonp"+new Date().getTime(),success:function(n){if(n!=null&&n.code=="00000000"&&n.data&&n.data.rtnCode=="000000"){document.location=j
}else{if(n.data&&n.data.rtnCode!="000000"){alert("业务异常："+n.data.rtnMsg)}else{alert("接口异常："+n.msg)}document.location=e}},error:function(o,n){alert("接口异常");document.location=j}})}b.gotoCheckout=function(j){if(j&&Number(j)){a=j;f.globalCheckLogin(g)}else{alert("参数异常");document.location=e}};return b});