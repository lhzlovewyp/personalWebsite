(function(a){a(function(){var b=window.loli||(window.loli={});var t=b.app=b.app||{};var m=b.app.order=b.app.order||{};var w=b.yhdStore;var n=a.cookie("provinceId");var e=a.cookie("yihaodian_uid");var f="top_prism_order";var o="top_prism_order_num_"+e;var q=(typeof globalTopPrismFlag!="undefined"&&globalTopPrismFlag=="0")?0:1;var c=a("#hdPrismWrap");var l=a("#hdPrismOrder");var h=a("#hdPrismOrderNum");var g=a("#hdPrismOrderList");if(!e||!n||!q){return}var r=function(){if(w){var x=w.isIE();if(x==0||x>=9||(x==8&&w.isRoot())){w.getFromRoot(o,function(z){if(z&&z.status==1){var y=(z.value&&!isNaN(z.value))?parseInt(z.value):0;l.data("ordersNumData",y);if(y>0){h.text(y<=99?y:99);h.show()}else{if(isNaN(z.value)||z.value==null){k()}}}else{k()}})}else{k()}}};var k=function(){var x=URLPrefix.central+"/homepage/ajaxFindTopPrismOrdersNum.do?callback=?";
var y=function(A){l.data("ordersNumData",A);l.data("ordersNumLoaded",1);if(A>0){h.text(A<=99?A:99);h.show()}else{h.text("");h.hide()}if(w){w.setFromRoot(o,A)}};var z={userId:e,currSiteId:(typeof currSiteId=="undefined")?1:currSiteId,currSiteType:1,provinceId:n};a.getJSON(x,z,function(A){var C=A;if(C){if(C.status==1){var B=C.result;y(B)}}})};var u=function(){var y=URLPrefix.central+"/homepage/ajaxFindTopPrismOrders.do?callback=?";var x=function(B){l.data("ordersData",B);var A=v(B);g.removeClass("global_loading").html(A);g.height("auto")};var z={userId:e,currSiteId:(typeof currSiteId=="undefined")?1:currSiteId,currSiteType:1,provinceId:n};a.getJSON(y,z,function(A){var C=A;if(C){if(C.status==1){var B=C.orders;x(B)}}})};var v=function(D){var V="http://image.yihaodianimg.com/front-homepage/global/images/defaultproduct_60x60.jpg";
var K=typeof URLPrefix.my!="undefined"?URLPrefix.my:"http://my.yhd.com";var U="http://my.yhd.com/order/myOrder.do";var X="http://cms.yhd.com/cmsPage/show.do?pageId=65818";var T=[];if(D&&D.length>0){T.push("<p class='hd_order_tips'><a class='blue_link' href='"+X+"' target='_blank' data-ref='"+f+"_download'>下载手机客户端，轻松查询配送信息</a></p>");for(var H=0;H<D.length;H++){var F=D[H];var Q=F.status;var y=F.actionType;var L=y==1?"待付款":(y==2?"待收货":(y==3?"待评论":""));var N=K+"/order/orderDetail.do?orderCode="+F.code;var M=f+"_detail_"+F.id;var I="http://e.yhd.com/front-pe/pe/orderProductExperience!orderProductExperience.do?soId="+F.id+"&userId="+e+"&hasCommented=false&soType=0";var z=f+"_comment_"+F.id;var O="http://my.yhd.com/order/finishOrder.do?orderCode="+F.code;var J=f+"_pay_"+F.id;var W="http://e.yhd.com/front-pe/couriers/deliveryStaff!comment.do?soId="+F.id;
var G=f+"_commentExpress_"+F.id;if(!F.hasSubOrders){T.push("<div class='hd_order_list'>");T.push("<a href='"+N+"' target='_blank' data-ref='"+M+"' class='hd_order_num'>");if(y==3&&!F.deliveryMsg){var A=j(Q);if(A){T.push("<b><i></i>"+A+"</b>")}}T.push("订单号："+F.code);T.push("</a>");if(F.deliveryMsg){T.push("<p class='hd_order_status'>"+F.deliveryMsg+"</p>")}T.push("<div class='hd_pro_list'>");T.push("<div class='clearfix'>");for(var E=0;E<F.items.length;E++){var B="http://item-home.yhd.com/item/snapshotShow.do?productId="+F.items[E].productId+"&soItemId="+F.items[E].soItemId+"&flag=1";var R=d(F.items[E].productPicPath?F.items[E].productPicPath:V);var S=f+"_item_"+F.items[E].productMerchantId;if(E>2){break}T.push("<a href='"+B+"' target='_blank' data-ref='"+S+"'><img src='"+b.util.hashImgUrl(R)+"' /></a>")
}T.push("</div>");T.push("</div>");if(y==1){T.push("<div class='hd_btn_wrap'><a href='"+O+"' target='_blank' data-ref='"+J+"' class='hd_pay_btn'>立即支付</a></div>")}else{if(y==3){if(1==F.hasCommentExpress){T.push("<div class='hd_btn_wrap'>")}else{T.push("<div class='hd_btn_wrap hd_shop_order'>")}T.push("<a href='"+I+"' target='_blank' data-ref='"+z+"' class='hd_comment_btn'>立即评论");if(0==F.hasCommentGiftActivity){if(1==F.commentActivityType){T.push("<em class='hd_gift_icon'></em>")}else{if(2==F.commentActivityType){T.push("<em class='hd_fanxian_icon'></em>")}}}T.push("</a>");if(1==F.hasCommentExpress){T.push("<a class='hd_comment_express' href='"+W+"' target='_blank' data-ref='"+G+"'>评论快递小哥</a>")}T.push("</div>")}}T.push("</div>")}else{I="http://e.yhd.com/front-pe/pe/orderProductExperience!orderProductExperience.do?soId="+F.id+"&userId="+e+"&hasCommented=false&soType=1";
T.push("<div class='hd_order_list'>");T.push("<a href='"+N+"' target='_blank' data-ref='"+M+"' class='hd_order_num'>订单号："+F.code+"</a>");for(var C=0;C<F.subOrders.length;C++){var x=F.subOrders[C];var P="";if(x.deliveryMsg){P=x.deliveryMsg}if(y==3&&!x.deliveryMsg){P=j(x.status)}W="http://e.yhd.com/front-pe/couriers/deliveryStaff!comment.do?soId="+x.id;G=f+"_commentExpress_"+x.id;T.push("<p class='hd_order_status'><i>包裹"+(C+1)+"</i>"+P+"</p>");T.push("<div class='hd_pro_list'>");T.push("<div class='clearfix'>");for(var E=0;E<x.items.length;E++){var B="http://item-home.yhd.com/item/snapshotShow.do?productId="+x.items[E].productId+"&soItemId="+x.items[E].soItemId+"&flag=1";var R=d(x.items[E].productPicPath?x.items[E].productPicPath:V);var S=f+"_item_"+x.items[E].productMerchantId;if(E>2){break}T.push("<a href='"+B+"' target='_blank' title='"+x.items[E].productName+"' data-ref='"+S+"'><img src='"+b.util.hashImgUrl(R)+"' title='"+x.items[E].productName+"'/></a>")
}T.push("</div>");if(1==x.hasCommentExpress){T.push("<div class='hd_subbtn_wrap'>");T.push("<a class='hd_comment_express' href='"+W+"' target='_blank' data-ref='"+G+"'>评论快递小哥</a>");T.push("</div>")}T.push("</div>")}if(y==1){T.push("<div class='hd_btn_wrap'><a href='"+O+"' target='_blank' data-ref='"+J+"' class='hd_pay_btn'>立即支付</a></div>")}else{if(y==3){T.push("<div class='hd_btn_wrap hd_shop_order'>");T.push("<a href='"+I+"' target='_blank' data-ref='"+z+"' class='hd_comment_btn'>立即评论</a>");if(0==F.hasCommentGiftActivity){if(1==F.commentActivityType){T.push("<em class='hd_gift_icon'></em>")}else{if(2==F.commentActivityType){T.push("<em class='hd_fanxian_icon'></em>")}}}T.push("</div>")}}T.push("</div>")}}T.push("<a class='hd_more_btn' href='"+U+"' target='_blank' data-ref='"+f+"_more'>查看更多</a>")
}else{T.push("<div class='hd_none_tips'>");T.push("<span class='hd_none_icon'></span>");T.push("<p class='hd_none_text'>您还没有订单哦~</p>");T.push("</div>")}return T.join("")};var d=function(x){if(x){x=x.replace("_40x40.","_60x60.")}return x};var j=function(y){var x="";if(y==20){x="已出库"}else{if(y==24){x="已收货"}else{if(y==35){x="已完成"}}}return x};var s=function(){var x=a("a.hd_prism_tab",l);x.attr("href","javascript:void(0);");x.removeAttr("target");x.click(function(){if(l.data("dataLoaded")=="1"&&l.hasClass("hd_cur")){i(l);return}if(!l.data("ordersNumLoaded")){k()}var y=function(z){if(z.result==1){if(l.data("dataLoaded")=="1"){p(l)}else{l.data("dataLoaded","1");g.height("100");p(l);u();if(x.data("clicked")!=1){gotracker("2",f);x.data("clicked",1)}}}else{if(yhdPublicLogin){yhdPublicLogin.showLoginDiv()
}}};b.globalCheckLogin(y)});a(document.body).click(function(y){var z=a(this);var A=y.target?y.target:y.srcElement;if(A){var B=a(A).parents("div.hd_prism_wrap").size();if(B==0&&l.hasClass("hd_cur")){l.removeClass("hd_cur")}}})};var p=function(x){c.find("div.hd_prism,div.hd_mini_cart").removeClass("hd_cur");x.addClass("hd_cur")};var i=function(x){x.removeClass("hd_cur")};m.showNum=function(){r();s()};window.topOrderTimeoutHandler=setTimeout(function(){if(l.size()>0){m.showNum()}},3*1000)})})(jQuery);