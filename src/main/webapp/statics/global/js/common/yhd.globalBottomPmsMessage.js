(function(a){a(function(){var h=YHDOBJECT.globalVariable().globalPageCode;var d=a.cookie("provinceId");if(typeof(h)=="undefined"||h==-1){return}if(!d){return}if(jQuery("#globalBottomBrowseRelated").length<1){return}var l={currSiteId:currSiteId,currSiteType:1,provinceId:d,pageCode:h,pmid:a("#productMercantId").val(),merchantId:a("#merchantId").val(),userid:a.cookie("yihaodian_uid"),showWideScreen:(typeof isWidescreen!="undefined"&&isWidescreen==true)?true:false,showBigWideScreen:(typeof isBigWidescreen!="undefined"&&isBigWidescreen==true)?true:false};var f=function(p){n("#globalBottomBrowseRelated",function(){j(p)})};var j=function(p){o(p);b()};var o=function(p){a.extend(l,p)};var b=function(){var p=URLPrefix.pms+"/pms/bottomRec.do?";urlStr=[];urlStr.push(p);for(var q in l){var r=l[q];if(r){urlStr.push(q+"="+l[q]+"&")
}}urlStr.push("callback=?");a.getJSON(urlStr.join(""),function(t){if(t){var s=t.value[0];if(s&&s&&s.status==1){e(s)}}})};var e=function(x){var C=a("#globalBottomBrowseRelated");if(C.length<1){return}var B=[];var D=[];var G=x.lTrackerPrefix;var p=x.rTrackerPrefix;var M=x.sourceObject;var I=x.productList;var O=x.exposureCode;var z=x.promTrackerPrefix;var r=x.guideTrackerPrefix;B.push('<div class="browse_related">');B.push('<div class="clearfix">');B.push('<div class="browse_related_left" id="browseHistory">');B.push("<h4>浏览记录</h4>");B.push('<div class="paging">');var K=M.length;var t=I.length;totalSize=parseInt((K-1)/4)+1;B.push('<a class="prev" href="javascript:void(0);"></a><em><b class="cur_page">1</b>/<span>'+totalSize+'</span></em><a class="next" href="javascript:void(0);"></a>');B.push("</div>");
B.push('<div class="paging_wrap browse_history_wrap">');B.push('<ul class="browse_history_con clearfix" style="margin-left: 0px;">');var L;if(K<1){L="猜你喜欢的商品";B.push('<li><div class="browse_history_none"><dt>尚未浏览商品</dt><dd></dd></div></li>')}else{L="与您浏览记录相关的商品";for(var q=0;q<totalSize;q++){B.push("<li>");var v=(q+1)*4<K?(q+1)*4:K;for(var F=q*4;F<v;F++){var y=M[F];var A=y.samMemberPrice?1:0;D.push(y.pmId);B.push('<div class="browse_history_list">');B.push('<a href="'+y.linkUrl+'" target="_blank" class="pro_img" data-ref="'+G+"_"+y.productId+"_"+F+'"><img src="'+m.util.hashImgUrl(y.picUrl)+'"></a>');B.push("<div>");B.push('<a title="'+y.cnName+'" href="'+y.linkUrl+'" target="_blank" data-ref="'+G+"_"+y.productId+"_"+F+'">'+y.cnName+"</a>");if(A){B.push('<p class="sam_price" data-productId="'+y.pmId+'" data-samFlag="1"><b>¥'+y.samMemberPrice+'</b><em class="sam_icon"></em></p>')
}else{B.push('<p data-productId="'+y.pmId+'"><b>¥'+y.salePrice+"</b></p>")}B.push("</div>");B.push("</div>")}B.push("</li>")}}B.push("</ul>");B.push("</div>");B.push("</div>");B.push('<div class="browse_related_right">');B.push("<h4>"+L+"</h4>");B.push('<div class="browse_related_list" id="alsoBuyBox">');B.push('<a href="javascript:;" class="prev">上一页</a>');B.push('<div class="paging_wrap slide_box">');B.push('<ul class="clearfix" style="margin-left: 0px;">');for(var q=0;q<t;q++){var y=I[q];var A=y.samMemberPrice?1:0;D.push(y.pmId);B.push('<li class="">');B.push('<a class="pic" title="'+y.cnName+'" href="'+y.linkUrl+'" target="_blank" data-ref="'+p+"_"+y.productId+"_"+q+'"><img src="'+m.util.hashImgUrl(y.picUrl)+'"></a>');B.push('<a title="'+y.cnName+'" href="'+y.linkUrl+'" target="_blank" class="pro_name" data-ref="'+p+"_"+y.productId+"_"+q+'">'+y.cnName+"</a>");
if(!A){B.push('<p class="price" data-productId="'+y.pmId+'"><strong>¥'+y.salePrice+"</strong></p>")}else{B.push('<p class="price sam_price" data-productId="'+y.pmId+'" data-samFlag="1"><strong>¥'+y.samMemberPrice+"</strong><em></em></p>")}var w=y.promotions;if(w&&w.length>0){var E=w[0];B.push('<p class="prolist_link"><a target="_blank" href="'+E.linkUrl+'" title="'+E.name+'" data-ref="'+z+"_"+y.productId+"_"+E.id+'">'+E.name+"</a></p>")}else{B.push('<p class="prolist_link"><a></a></p>')}if(y.buttonType==2&&!A){var s=2;if(y.pmId){s=y.pmId}B.push('<p class="glbtn"><a onclick="gotracker('+s+",'"+p+"Btn_"+q+"','"+y.productId+"');addToCart(event,'"+y.productId+"','"+y.merchantId+"','"+y.shoppingCount+"',false,'"+p+"Btn_0');\">加入购物车</a></p>")}else{B.push('<p class="glbtn"><a href="'+y.linkUrl+'" target="_blank" data-ref="'+p+"_"+y.productId+"_"+q+'">查看详情</a></p>')
}B.push('<div class="pro_label clearfix">');var P=y.guideProperties;var J=P.length;if(P&&J>0){for(var F=0;F<J;F++){var H=P[F];var u=r+"_"+y.productId+"_"+H.id;B.push('<span><a target="_blank" href="'+H.linkUrl+'" title="'+H.name+'" data-ref="'+u+'">'+H.name+"</a></span>")}}B.push("</div>");B.push("</li>")}B.push("</ul>");B.push("</div>");B.push('<a href="javascript:;" class="next" style="display: block;">下一页</a>');var N;if(l.showBigWideScreen){N=parseInt((t-1)/6)+1}else{if(l.showWideScreen){N=parseInt((t-1)/5)+1}else{N=parseInt((t-1)/4)+1}}B.push('<em class="page_num"><i class="cur_page">1</i>/<span>'+N+"</span></em>");B.push("</div></div></div></div>");C.html(B.join(""));C.addClass("browse_related_wrap mt");g.loadFun(C);gotracker("2",O);i(D)};var i=function(s){var u="";var p=URLPrefix.busystock?URLPrefix.busystock:"http://gps.yhd.com";
if(s.length<1){return}for(var r=0;r<s.length;r++){u+="&pmIds="+s[r]}try{var q=p+"/restful/promotion?mcsite="+currSiteId+"&provinceId="+d+u+"&callback=?";jQuery.getJSON(q,function(v){if(!v||v.ERROR){return}jQuery.each(v,function(z,x){var y=jQuery("#globalBottomBrowseRelated p[data-productId='"+x.pmId+"']");if(y&&y.attr("data-samFlag")!="1"){var w="¥"+x.price;y.find("b").text(w);y.find("strong").text(w)}})})}catch(t){}};var n=function(q,s){var p=jQuery(q).offset().top;if(k()<p){var r=function(){if(k()>=jQuery(q).offset().top){s();a(window).unbind("scroll",r)}};a(window).bind("scroll",r)}else{s()}};var k=function(){var t=document,p=t.documentElement,s=t.body,q=Math.max(p.scrollTop,s.scrollTop),r=p.clientHeight+q;return r};var g={browseRelatedHover:function(){var p=a("#globalBottomBrowseRelated").find(".browse_related_list .slide_box");
p.delegate("li","mouseover",function(){a(this).addClass("cur").siblings("li").removeClass("cur")});p.delegate("li","mouseout",function(){p.find("li").removeClass("cur")})},bottomRecmdSlide:function(p,w){var p=a(p),v=p.find(".prev"),z=p.find(".next"),q=p.find(".cur_page"),y=p.find("ul"),x=y.find("li"),s=Math.ceil(p.find(".paging_wrap").width()/x.outerWidth(true)),B=Math.ceil(x.length/s),u=x.outerWidth(true)*s,A=0,t=p.find(".turn").find("span"),r;if(B>1){z.addClass("next_clickable")}p.delegate(".next_clickable","click",function(){A++;r(A)});p.delegate(".prev_clickable","click",function(){A--;r(A)});p.delegate(".turn span","click",function(){var D=a(this),C=D.index();if(!D.hasClass("cur")){r(C)}});r=function(C){q.text(C+1);t.removeClass("cur");t.eq(C).addClass("cur");if(C==0){v.removeClass("prev_clickable");
z.addClass("next_clickable")}else{if(C==(B-1)){v.addClass("prev_clickable");z.removeClass("next_clickable")}else{v.addClass("prev_clickable");z.addClass("next_clickable")}}y.animate({marginLeft:-u*C},w)}},loadFun:function(){g.browseRelatedHover();g.bottomRecmdSlide("#browseHistory",500);g.bottomRecmdSlide("#alsoBuyBox",500)}};var m=window.loli||(window.loli={});m.app=m.app||{};var c=m.app.pms=m.app.pms||{};c.loadBottomBrowseRelated=f;c.loadBottomBrowseRelated()})})(jQuery);