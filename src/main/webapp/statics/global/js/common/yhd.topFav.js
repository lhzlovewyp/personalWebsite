(function(b){b(function(){var o=b.cookie("provinceId");var m=b.cookie("yihaodian_uid");var k=(typeof globalTopPrismFlag!="undefined"&&globalTopPrismFlag=="0")?0:1;if(!m||!o||!k){return}var a=window.loli||(window.loli={});var n=0;var p=[];var l={};if(b("#glShouCangChild").size()==0){return}var r=typeof URLPrefix.my!="undefined"?URLPrefix.my:"http://my.yhd.com";a.globalCheckLogin(q);function q(d){if(!d||!d.result||d.result!=1){return}var g=r+"/member/myNewFavorite/myUserFavoriteInfo.do?callback=?";var c={favoriteType:0};b.getJSON(g,c,function(i){var j=i;if(j){if(j.code==0){var t=j.resultList;f(t)}else{}}});function f(j){if(!j||j.length<1){return}var v=[];for(var i=0;i<j.length;i++){var u=j[i];if(!u.price||!u.listPrice){continue}v.push(u);l[u.pmInfoId]=u}h(v)}function h(i){if(!i||i.length<1){return
}var y=[];var t=-1;for(var j=0;j<i.length;j++){var A=i[j];if(j%10==0){t=t+1;if(!y[t]){y[t]=[]}y[t].push(A.pmInfoId)}else{y[t].push(A.pmInfoId)}}n=y.length;for(var B=0;B<n;B++){e(y[B])}var z=setInterval(function(){if(n<=0){var Y=p.length;clearInterval(z);var u=b("#glShouCangChild");var Z=[];Z.push('<em style="width: 86px;"></em>');Z.push("<dl>");var O=[];var w=0;for(var s=0;s<Y;s++){var x=p[s];if(x==null||x.pmInfoId==null||x.productId==null||!x.isPromotion||!x.promotionInfo||x.promotionInfo.length<1){continue}w++;var S=x.promotionInfo[0];var R=l[x.pmInfoId];X="pms_191_prism_fav_pro_p_"+R.pmInfoId;var U="http://item.yhd.com/item/"+R.pmInfoId;var Q=yhdToolKit.getProductPicByDefaultPic(R.productUrl,60,60);O.push("<dd>");O.push('<a class="hd_pro_img" data-tpc="21" href="'+U+'" data-ref="'+X+'" target="_blank"><img src="'+a.util.hashImgUrl(Q)+'"></a>');
O.push('<a class="hd_pro_name" data-tpc="22" href="'+U+'" data-ref="'+X+'" target="_blank">'+R.productName+"</a>");O.push('<p class="hd_pro_price">¥'+R.price+"</p>");if(S.type==2||S.type==3){var T="http://list.yhd.com/p/c0-b-a-s1-v0-p1-price-d0-pid"+R.productId+"-pt"+S.promotionId+"-pl"+S.levelId+"-m0";var X="pms_191_prism_fav_pro_l_"+S.promotionId;O.push('<p class="hd_sale_tips"><i></i><a data-tpc="23" href="'+T+'" data-ref="'+X+'" target="_blank">'+S.promDesc+"</a></p>")}else{O.push('<p class="hd_sale_tips"><i></i><a>'+S.promDesc+"</a></p>")}O.push("</dd>")}if(w>0){Z.push("<dt>您收藏的商品中有<b>"+w+"</b>个商品正在促销</dt>")}else{return}Z.push(O.join(" "));Z.push("</dl>");var P="http://my.yhd.com/member/myNewCollection/myFavorite.do?operType=0";var W="http://my.yhd.com/member/myNewCollection/myFavorite.do?operType=1";
Z.push('<div class="hd_btn_wrap clearfix"><a data-tpc="24" href="'+P+'" data-ref="global_prism_fav_pro_more" target="_blank">我收藏的商品</a><a data-tpc="25" href="'+W+'"  data-ref="global_prism_fav_shop_more" target="_blank">我收藏的店铺</a></div>');u.html(Z.join(" "));u.removeClass("hd_menu_list").addClass("hd_favorites");var V=b("#glShouCang").find(".hd_menu");var v=V.find("span");v.html(v.html().replace(/&nbsp;/g,""));V.html(V.html()+'<u class="hd_fav_num">'+w+"</u>")}},1000)}function e(i){var w="";for(var x=0;x<i.length;x++){if(i[x]==""||i[x]<=0){continue}w+="&pmInfoIds="+i[x]}if(!w){return}var y=URLPrefix.central+"/homepage/ajaxFindProductPromotions.do?callback=?";var j={mcsiteId:1,pmInfoIds:i.join(","),provinceId:o};var z=0;jQuery.getJSON(y,j,function(s){if(z==1){return}z=1;n--;if(!s||s.status!=1){return true
}p=p.concat(s.result)});setTimeout(function(){if(z=0){z=1;n--}},2000)}}})})(jQuery);