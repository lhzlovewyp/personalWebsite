(function(a){var c=function(e){var d=e,f={lazyImg:{ltime:"2000",lnum:"5",load:true,indexLoad:false,scrollLoad:true,attr:"original",wideAttr:null,hfix:100}};a.extend(f,d);this.param=f};c.prototype={constructor:c,isBusy:false,doc:document,imgArray:[],wideAttr:null,lazyImg:function(f,d){var e=this,h=e.param.lazyImg,i,g=f;if(d){e.param.lazyImg=a.extend(h,d)}if(g instanceof a){i=g}else{if(a.isArray(g)){g=a(g.join(","))}else{g=a(g)||a("body")}}if(h.wideAttr){wideAttr=h.wideAttr;e.imgArray=g.find("img["+h.attr+"],img["+wideAttr+"]")}else{e.imgArray=g.find("img["+h.attr+"]")}if(h.indexLoad){e._lazyImg(e.imgArray,h)}if(h.scrollLoad){e._iniLazy(function(){if(e.imgArray.length==0){return i}e._lazyImg(e.imgArray,h)})}if(h.load){e._loadImg(g)}return f},_loadImg:function(h){var f=this,e=f.param.lazyImg,d=e.attr,i=e.ltime,g=e.lnum;
(function(m,n,j,o,l){var k=setInterval(function(){if(m.isBusy){return false}var q=m.imgArray;var p=q.length;if(p>l){m._imgLoad(q,0,l,j)}else{if(p>0){m._imgLoad(q,0,p,j)}else{clearInterval(k)}}},o)})(f,h,d,i,g)},_lazyImg:function(k,e){var i=e.attr,h=k.length,g=this,f=0,j=1;g.isBusy=true;var d=g._pageTop();g._imgLoad(g.imgArray,f,h,i,d,e.hfix);g.isBusy=false},_imgLoad:function(o,e,j,m,h,k){var g=this;if(h){for(var n=e;n<j;n++){var d=a(o[n]);var l=jQuery(window).height()+k;if(d.offset().top<(h+k)&&(h-d.offset().top)<l){g._renderImg(d,m);delete o[n]}}}else{for(var n=e;n<j;n++){var d=a(o[n]);g._renderImg(d,m);delete o[n]}}var f=new Array();for(var n=0;n<o.length;n++){if(o[n]!=null){f.push(o[n])}}g.imgArray=f},_renderImg:function(d,f){var e=d;if(typeof wideAttr!="undefined"&&wideAttr!=null&&e.attr(wideAttr)){e.attr("src",loli.webp(e.attr(wideAttr)));
e.removeAttr(f)}else{e.attr("src",loli.webp(e.attr(f)));e.removeAttr(f)}},_iniLazy:function(d){var e=this;loli.delay(window,"scroll",function(){if(!e.isBusy){e.isBusy=true;return true}else{return false}},function(){d()},50)},_pageTop:function(){var e=this,d=e.doc,f=d.documentElement;return f.clientHeight+Math.max(f.scrollTop,d.body.scrollTop)},_hashImgUrl:function(d){if(loli&&loli.util){return loli.util.hashImgUrl(d)}return d}};var b=new c();a.fn.extend({lazyImg:function(e){var d=new c();return d.lazyImg(this,e)}})})(jQuery);