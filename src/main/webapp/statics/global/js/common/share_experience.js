var shareProductId="";var shareMerchantId="";var shareOrderId="";var shareContentgood="";var shareImage_url="";var productname="";var urlPrefix=URLPrefix.central;var urlPrefixComment=URLPrefix.my;function apperarShareSuccess(e,d){if(e.value==-1){yhdPublicLogin.showLoginDivNone(URLPrefix.passport,false,"",function(a){if(a==0){yhdPublicLogin.showTopLoginInfo()}});return}if(e.value==0){var b=jQuery("#ex_prompt");YHD.popwin(b.html(),466,283);return}var c=urlPrefixComment+"/member/exp/showProductExcerienceDiv.do?productId="+d+"&merchantId="+shareMerchantId+"&soId="+shareOrderId+"&callback=?";jQuery.getJSON(c,function(f){if(f.value==null||f.value==""||f.ERROR){}else{YHD.popwin(f.value);YHD.popwin(f.value,jQuery(".popbox").width(),jQuery(".popbox").height());jQuery(".popbox").bgiframe();new Stars("stars1");
var a=jQuery("#experience_info").attr("soid");if(jQuery("#stars_desc").size()>0&&jQuery("#stars_atti").size()>0&&jQuery("#stars_logi").size()>0){new Stars("stars_desc");new Stars("stars_atti");new Stars("stars_logi")}shareMerchantId=jQuery("#experience_info").attr("merchantid");jQuery("[name=experience.submit]").click(function(){shareMerchantId=jQuery("#experience_info").attr("merchantid");deployShareExperience(shareProductId,shareMerchantId,a)})}})}function deployShareExperience(m,e,f,j){shareProductId=m;shareMerchantId=e;var g=/<[^> ]+>/;var c=urlPrefix+"/product/deployExperience.do?productID="+m+"&merchantID="+e+"&action=create&soId="+f;var k=jQuery("#contentTitle").val();if(k&&""!=jQuery.trim(k)){k=k.replace(/(^\s*)|(\s*$)/g,"");if(k.length>15){jQuery("span[id='titleDesc']").html("<em class='r'>*超出15个字的字数限制</em>");
return}if(k.length<5){jQuery("span[id='titleDesc']").html("<em class='r'>*内容不少于5个字</em>");return}if(g.exec(k)){jQuery("span[id='titleDesc']").html("<em class='r'>*请填写评论标题(5-15个字)</em>");return}}else{jQuery("span[id='titleDesc']").html("<em class='r'>*请填写评论标题(5-15个字)</em>");return}jQuery("span[id='titleDesc']").html("<em class='r'>*</em>请填写评论标题(5-15个字)");c=c+"&title="+encodeURIComponent(encodeURIComponent(k));var b=true;var i="#yhd_pop_win .ipt3,#yhd_pop_win .ipt6";if(j&&j=="publishExperience"){i="#publishExperience .ipt3,#publishExperience .ipt6"}jQuery(i).each(function(r){var p=jQuery(this).attr("nullTitile");var q=jQuery(this).attr("categoryTitile");var o=jQuery(this).attr("experienceTitle");var n=jQuery(this).val().replace(/(^\s*)|(\s*$)/g,"");if(n==""){if(q=="contentGood"){jQuery("span[id='contentTitle1Desc']").html("<em class='r'>*请填写评论内容(5-200字)</em>");
b=false;return false}jQuery("span[id='contentTitle1Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)");if(q=="contentFail"){jQuery("span[id='contentTitle2Desc']").html("<em class='r'>*请填写评论内容(5-200字)</em>");b=false;return false}jQuery("span[id='contentTitle2Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)");if(q=="content"){jQuery("span[id='contentTitle3Desc']").html("<em class='r'>*请填写评论内容(5-200字)</em>");b=false;return false}jQuery("span[id='contentTitle3Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)")}if(n.length>200){if(q=="contentGood"){jQuery("span[id='contentTitle1Desc']").html("<em class='r'>*超出200个字的字数限制</em>");b=false;return false}jQuery("span[id='contentTitle1Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)");if(q=="contentFail"){jQuery("span[id='contentTitle2Desc']").html("<em class='r'>*超出200个字的字数限制</em>");
b=false;return false}jQuery("span[id='contentTitle2Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)");if(q=="content"){jQuery("span[id='contentTitle3Desc']").html("<em class='r'>*超出200个字的字数限制</em>");b=false;return false}jQuery("span[id='contentTitle3Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)")}if(n.length<5){if(q=="contentGood"){jQuery("span[id='contentTitle1Desc']").html("<em class='r'>*内容不少于5个字</em>");b=false;return false}jQuery("span[id='contentTitle1Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)");if(q=="contentFail"){jQuery("span[id='contentTitle2Desc']").html("<em class='r'>*内容不少于5个字</em>");b=false;return false}jQuery("span[id='contentTitle2Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)");if(q=="content"){jQuery("span[id='contentTitle3Desc']").html("<em class='r'>*内容不少于5个字</em>");
b=false;return false}jQuery("span[id='contentTitle3Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)")}if(g.exec(n)){if(q=="contentGood"){jQuery("span[id='contentTitle1Desc']").html("<em class='r'>*</em>请填写评论内容(5-200个字)");b=false;return false}jQuery("span[id='contentTitle1Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)");if(q=="contentFail"){jQuery("span[id='contentTitle2Desc']").html("<em class='r'>*</em>请填写评论内容(5-200个字)");b=false;return false}jQuery("span[id='contentTitle2Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)");if(q=="content"){jQuery("span[id='contentTitle3Desc']").html("<em class='r'>*</em>请填写评论内容(5-200个字)");b=false;return false}jQuery("span[id='contentTitle3Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)")}c=c+"&"+q+"="+encodeURIComponent(encodeURIComponent(n))+"&"+o+"="+encodeURIComponent(encodeURIComponent(p))
});if(b){var l=getStartvalue("#stars1-input");var h=5;var a=5;var d=5;if(jQuery("#stars_logi-input").size()>0&&jQuery("#stars_atti-input").size()>0&&jQuery("#stars_desc-input").size()>0){h=getStartvalue("#stars_logi-input");a=getStartvalue("#stars_atti-input");d=getStartvalue("#stars_desc-input")}jQuery("[name=experience.submit]").css("disabled",true);c=c+"&qualityRating="+l+"&deliveryRating=5&serviceRating=5&mdeliveryPoint="+h+"&mservicePoint="+a+"&mdescriptPoint="+d+"&callback=?";jQuery(".evaBtn").attr("disabled","disabled");jQuery.getJSON(c,function(n){jQuery(".evaBtn").removeAttr("disabled");if(n.ERROR){}else{jQuery(".popwinClose").click();showShareDeployPage(n,j)}});return true}else{return false}}function getStartvalue(c){var a=jQuery(c);var b="5";if(a&&a.val()!=""&&a.val()!=null){b=a.val()
}return b}function showErrorTitle(b,a){jQuery("#"+b).css({color:"#666",display:"inline-block",height:"23px","line-height":"23px",padding:"0 5px",border:"1px solid #FF8080","background-color":"#FFF2F2"});jQuery("#"+b).html(a);setTimeout(function(){jQuery("#"+b).removeAttr("style");jQuery("#"+b).html("")},9000)}function showShareDeployPage(b,d){var c=b.value.split("=");var a=c[0];var f=c[1];if(a==1){jQuery(".popwinClose").click();window.scrollTo(0,0);var e='<div class="popup_cont"><div class="prompted"><img src="'+URLPrefix.statics+'/member/images/okay.png"/><h3>提交成功！ </h3><p>'+f+'!</p></div><p class="countdown">3秒后自动关闭</p><a href="javascript:void(0);" class="close">关闭</a></div>';popMsg(e,".popup_cont .close",378,120);if(jQuery("#categoryAllProducts")&&jQuery("#categoryAllProducts").size()>0){loadExpInfo(1)
}if(jQuery("#noCommentProductsView")&&jQuery("#noCommentProductsView").size()>0){loadNoCommentProductInfo()}if(jQuery("#myOrderList")&&jQuery("#myOrderList").size()>0){orderListPageInfo(1)}setTimeout(function(){jQuery(".popup_cont .close").click();openShare();if(d&&d=="publishExperience"){jQuery("#contentTitle").attr("value","");jQuery(".ipt3, .ipt6").each(function(g){jQuery(this).attr("value","")})}},3000)}else{if(a==2){var e='<div class="popup_sens"><h3 class="title">提示<span class="close">关闭</span></h3><p class="popup_text">'+f+'</p><p class="btntip"><input type="button" value="确 定" /></p></div>';popMsg(e,".popup_sens .close,.btntip :button",398,150,250);jQuery(".popup_sens .close,.btntip :button").click(function(){openShare()});if(jQuery("#categoryAllProducts")&&jQuery("#categoryAllProducts").size()>0){loadExpInfo(1)
}if(jQuery("#noCommentProductsView")&&jQuery("#noCommentProductsView").size()>0){loadNoCommentProductInfo()}if(jQuery("#myOrderList")&&jQuery("#myOrderList").size()>0){orderListPageInfo(1)}if(d&&d=="publishExperience"){jQuery("#contentTitle").attr("value","");jQuery(".ipt3, .ipt6").each(function(g){jQuery(this).attr("value","")})}}else{var e='<div class="popup_sens"><h3 class="title">提示<span class="close">关闭</span></h3><p class="popup_text">'+f+'</p><p class="btntip"><input type="button" value="确 定" /></p></div>';popMsg(e,".popup_sens .close,.btntip :button",398,150);if(d&&d=="publishExperience"){jQuery("#contentTitle").attr("value","");jQuery(".ipt3, .ipt6").each(function(g){jQuery(this).attr("value","")})}}}}function popMsg(c,f,d,b,e){YHD.init();var a=jQuery("#yhd_pop_win");if(c!=null){jQuery(a).html(c)
}if(e){YHD.initPosition(a,d,b,e)}else{YHD.initPosition(a,d,b)}jQuery(a).jqm({overlay:10,overlayClass:"pop_win_bg",modal:true,toTop:true}).jqmShow().jqmAddClose(f)}function appearAndShareExperience(c,d,g,e,b){productname=b;var f=jQuery.cookie("ut");if(!f){yhdPublicLogin.showLoginDivNone(URLPrefix.passport,false,"",function(h){if(h==0){yhdPublicLogin.showTopLoginInfo()}});return}else{executiveLandedCheck();shareImage_url=e;shareProductId=c;if(d!=null&&d!=0&&g!=null&&g!=0){shareOrderId=g;shareMerchantId=d}else{g=null;d=null}var a=urlPrefix+"/product/checkItemCount.do?productID="+c+"&merchantId="+shareMerchantId+"&soId="+shareOrderId+"&callback=?";jQuery.getJSON(a,function(h){if(h.ERROR){}else{apperarShareSuccess(h,c)}})}}function openShare(){jQuery("#pop_win_ok_btn").click();var a=urlPrefixComment+"/member/exp/editShareExcerienceDiv.do?productId="+shareProductId+"&callback=?";
jQuery.getJSON(a,function(b){if(b.ERROR){}else{if(b.value!="noshare"){getSinaUrl(function(c){YHD.popwin(b.value,470,400);jQuery("[name=experience.cancel]").click(function(){jQuery(".popwinClose").click()});if(shareImage_url==""||productname==""||shareImage_url==null||productname==null){try{shareImage_url=jQuery("#mainPic").attr("tag");productname=jQuery("#productMainName").text()}catch(d){}}jQuery("[name='product_image']").attr("src",shareImage_url);shareContentgood="我在1号店买了【"+productname.substring(0,110)+"】 ";jQuery("[name='product_share_experience']").val(shareContentgood+c);jQuery("[name=experience.share]").click(function(){if(jQuery("[name='product_share_experience']").val().length>140){jQuery("#shareErrorMsg").html("<p>分享内容不能超过140字</p>")}else{if(jQuery("[name='product_share_experience']").val().length==0){jQuery("#shareErrorMsg").html("<p>分享内容不能为空</p>")
}else{var e=false;jQuery(":checkbox[name^='share_to_']").each(function(f){e=e||jQuery(this).attr("checked")});if(e){perpShareExcerience(shareProductId)}else{jQuery("#shareErrorMsg").html("<p>请选择分享平台</p>")}}}})})}}})}var sinaUrl="";function getSinaUrl(a){if(sinaUrl!=""){a(sinaUrl)}else{getShotURL("sina",a)}}function getShotURL(a,b){if(a=="sina"&&sinaUrl!=""){b(sinaUrl)}else{url=URLPrefix.passport+"/share/shotUrl.do?longUrl="+escape(URLPrefix.central+"/product/"+shareProductId+"?tarcker_u="+getpcode(a))+"&callback=?";jQuery.getJSON(url,function(c){b(c.shotUrl);if(a=="sina"){sinaUrl=c.shotUrl}})}}function getpcode(a){if("sina"==a){return"1047513694"}if("qq"==a){return"1057943695"}if("kaixin"==a){return"1095733696"}if("renren"==a){return"1020853697"}}var shareMsg="";var sig="";var exid="";function perpShareExcerience(a){shareMsg=encodeURIComponent(encodeURIComponent(jQuery("[name='product_share_experience']").val()));
sig=jQuery("#shareErrorMsg").attr("sign");exid=jQuery("#shareErrorMsg").attr("exid");validateShare(a,"sina");validateShare(a,"renren");validateShare(a,"qq");validateShare(a,"kaixin");jQuery(".popwinClose").click();YHD.alert("评论并且分享成功",null,476,27)}function validateShare(a,b){if(jQuery(":checkbox[name='share_to_"+b+"']")&&jQuery(":checkbox[name='share_to_"+b+"']").attr("checked")){shareExcerience(a,b)}}function createShareUrl(a,b,c){var d=URLPrefix.passport+"/share/"+b+"/publish.do?sign="+sig+"&exid="+exid+"&productId="+shareProductId+"&pubMessage.content="+shareMsg+"&pubMessage.title="+encodeURIComponent(encodeURIComponent("在一号店发布了购买体验"))+"&pubMessage.image="+escape(shareImage_url)+"&pubMessage.url="+escape(c)+"&sinaUrl="+escape(sinaUrl)+"&callback=?";return d}function shareExcerience(a,b){getShotURL(b,function(c){jQuery.getJSON(createShareUrl(a,b,c),function(d){})
})};