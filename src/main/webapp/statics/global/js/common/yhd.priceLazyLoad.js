(function(b){var a=function(f){var d=f,e=URLPrefix.busystock?URLPrefix.busystock:"http://gps.yhd.com",c="/busystock/restful/truestock";_setting={attr:"productid",busystock_url:e+c,busystockAttr:"productIds",lazyLoadDelay:500,priceCounter:30,load:true,maxNum:200,oneOffLoad:false,indexLoad:false,scrollLoad:true,hfix:100,callbackHtml:null};b.extend(_setting,d);this.param=_setting};a.prototype={constructor:a,isBusy:false,doc:document,priceArray:[],lazyPrice:function(i,d){var c=this,g=c.param;if(d){c.param=b.extend(g,d)}var h=i,f=g.attr,e=g.busystock_url,j=g.maxNum;if(h instanceof b){c.priceArray=i.find("["+f+"]").get()}else{if(b.isArray(h)){c.priceArray=h}else{c.priceArray=b(i).find("["+f+"]").get()}}if(g.oneOffLoad){c._flushPrice(c.priceArray,f,e,g.busystockAttr,j);return i}if(g.indexLoad){c._lazyPrice(c.imgArray,g)
}if(g.scrollLoad){c._iniLazy(function(){if(c.priceArray.length==0){return i}c._lazyPrice(c.priceArray,g)})}if(g.load){c._loadPrice()}return i},_loadPrice:function(){var d=this,i=d.param,h=i.attr,c=i.busystock_url,f=i.busystockAttr,g=i.maxNum,j=i.lazyLoadDelay,e=i.priceCounter;(function(o,m,n,p,r,l,q){var k=setInterval(function(){if(o.isBusy){return false}var s=o.priceArray;var t=s.length;if(t>q){o._priceLoad(s,m,n,p,0,q,r)}else{if(t>0){o._priceLoad(s,m,n,p,0,t,r)}else{clearInterval(k)}}},l)})(d,h,c,f,g,j,e)},_lazyPrice:function(j,h){var i=h.attr,c=j.length,f=h.busystock_url,e=h.busystockAttr,g=h.maxNum,k=this,l=0;k.isBusy=true;var d=k._pageTop()+h.hfix;k._priceLoad(j,i,f,e,l,c,g,d);k.isBusy=false},_priceLoad:function(n,m,p,l,e,h,j,d){var c=this,q=n.length;if(q==0){return}var g=new Array();if(d){for(var k=e;
k<h;k++){var o=b(n[k]);if(o.offset().top<d){g.push(o);delete n[k]}}}else{for(var k=e;k<h;k++){var o=b(n[k]);g.push(o);delete n[k]}}c._flushPrice(g,m,p,l,j);var f=new Array();for(var k=0;k<n.length;k++){if(n[k]!=null){f.push(n[k])}}c.priceArray=f},_iniLazy:function(c){var d=this;window.scrollTo(0,0);b(window).bind("scroll",function(){if(!d.isBusy){c()}else{}})},_pageTop:function(){var d=this,c=d.doc,e=c.documentElement;return e.clientHeight+Math.max(e.scrollTop,c.body.scrollTop)},_flushPrice:function(c,h,g,t,m){var l=this,w=l.param,k=w.callbackHtml;if(c&&c.length>0){var f=c.length,v=0,x,s=1;if(f<m){x=f}else{s=(f-1)/m+1}var r=jQuery.cookie("provinceId");if(!r){return}var o="?mcsite="+currBsSiteId+"&provinceId="+r;var q={};for(var n=0;n<s;n++){if(n>0){v=m*n;x=v+m;if(x>f){x=f}}q={};for(var p=v;
p<x;p++){var d=jQuery(c[p]);o+="&"+t+"="+d.attr(h);if(!q[d.attr(h)]){q[d.attr(h)]=[]}q[d.attr(h)].push(d)}try{jQuery.getJSON(g+o+"&callback=?",function(e){if(e==null||e==""){return}jQuery.each(e,function(i,j){var y=q[j.productId];if(y){jQuery.each(y,function(A,z){if(k){jQuery(z).html(k(j,z)).removeAttr(h)}else{if(currSiteId==2){jQuery(z).text("¥"+j.productPrice).removeAttr(h)}else{if(y){if(globalShowMarketPrice==1){var B="<strong>¥"+j.productPrice+"</strong>";B+="<del>¥"+j.marketPrice+"</del>";jQuery(z).html(B).removeAttr(h)}else{var B="<strong>¥"+j.productPrice+"</strong>";if(j.curPriceType&&j.curPriceType==2&&j.yhdPrice){B+="<del>¥"+j.yhdPrice+"</del>"}jQuery(z).html(B).removeAttr(h)}}}}})}})})}catch(u){}}}}};b.fn.extend({lazyPrice:function(d){var c=new a();return c.lazyPrice(this,d)}})})(jQuery);