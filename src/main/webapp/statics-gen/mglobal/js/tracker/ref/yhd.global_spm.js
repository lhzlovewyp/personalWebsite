define("tracker_ref_yhd.global_spm",["tracker_ref_yhd.uid","util_yhd.url"],function(L,F){var D={};var E=".";var N="0";var A="1";var z={TPA:"tpa",TPC:"tpc",TPI:"tpi",TCS:"tcs",TCD:"tcd",TCI:"tci",PC:"pc",TP:"tp",TC:"tc",ABTEST:"abtest",ABTEST_TAG:"abtest_tag",EXPR_TAG:"a,area,button",TPA_CHILD_SIZE:"tpaChildSize",TPC_CHILD_SIZE:"tpcChildSize",TC_CHILD_SIZE:"tcChildSize",RESULT:{RESULT:"result",TP:"tp",TC:"tc",UNIID:"uniId",PAGETYPE:"pageType",PAGEID:"pageId"}};var y=null,G=null,O=0;var B=L.genUID();D.getData=function(a,c){if(F.isSpider()){return{}}H();if(O==-1||O==2){return null}var b=new I(a,c);return b.getData()};D.getNewPageData=function(){H();var f=F.getParams(location.href)||{};var d=f.tp;var e=f.tc;var b=f.abtest;var a=0;var c=J();if(c&&c.length>0){b=N+E+c;a=1}return K(d,e,b,a)};D.reloadPage=function(a){D.refreshPage(window.location.href,a)
};D.refreshPage=function(a,c,b){var d=P(a,c,b);window.location.href=d};D.openPage=function(b,d,c,a){var e=P(d,b);var g="";if(typeof(c)!="undefined"&&c){g=c}var f="";if(typeof(a)!="undefined"&&a){f=a}window.open(e,g,f)};D.getABExpParam=function(b){var a=v(b);return a};D.glABcodeToTag=function(a){var b=C(a);return b};function P(g,a,k){if(!g){return""}var j=typeof(a);if(j=="undefined"||!a){return g}var e=null;if(j=="string"){var h=a;var b=a.indexOf("#");if(b===-1){h="#"+h}e=$(h)}else{if(j=="object"){e=a}}if(!e){return g}var f=D.getData(e,k);if(f){var m=f.tp;var c=f.tc;var l=f.abtestValue;var i={tp:m,tc:c,abtest:l};var d=F.appendParams(g,i);return d}else{return g}}function M(b,c){if(typeof(_globalSpmDataModelJson)!="undefined"&&_globalSpmDataModelJson){var a=0;if(b){a=_globalSpmDataModelJson[b]?_globalSpmDataModelJson[b][c]:""
}else{a=_globalSpmDataModelJson[c]}if(a){return a}}return c}function H(){var a=$("meta[name=tp_page]").attr("content");a=w(a);if(!a){O=-1;return}y=M(null,a[0]);G=a[1];if(y&&y=="0"){O=2}}function J(){var a=$("meta[name=global-abtest]");if(a&&a.length>0){return a.attr("content")}return""}function C(a){if(a&&a.length>0&&typeof(_globalABTestExpDataJson)!="undefined"&&_globalABTestExpDataJson&&_globalABTestExpDataJson[a]){var b=_globalABTestExpDataJson[a]["tag"];return b}return""}function v(b){if(b&&b.length>0&&typeof(_globalABTestExpDataJson)!="undefined"&&_globalABTestExpDataJson&&_globalABTestExpDataJson[b]){var a=_globalABTestExpDataJson[b]["expParam"];return a}return""}function I(a,c){var b=this;b._dom=a;b._opt={};b.TAG=c||z.EXPR_TAG;b.init()}I.prototype={init:function(){var e=this,f=e._dom;
if(!f){e.set(z.RESULT.RESULT,0);return}if(!(f instanceof $)){f=$(f)}var d=f.data(z.PC);if(d==1){e.set(z.RESULT.RESULT,1);return}else{if(d==-1){e.set(z.RESULT.RESULT,0);return}}var i=x(f,z.TPA);if(i.length<1){if(y){e.set(z.RESULT.RESULT,1);e.set(z.TPA,0);e.set(z.TPC,0);e.set(z.TPI,0)}else{e.set(z.RESULT.RESULT,0)}return}e.set(z.TPA,i.data(z.TPA));e.initTpaIndex(i);var a=f.data(z.TPI);if(!a){e.initNewTpaIndex(f,i)}e.set(z.TPC,f.data(z.TPC));e.set(z.TPI,f.data(z.TPI));var h=x(f,z.TC);if(h&&h.length>0){e.set(z.TC,h.data(z.TC))}else{e.initTcdIndex(i);var c=x(f,z.TCS);var g=x(f,z.TCD);if(g.length>0){if(!c.data(z.TCD)){e.initNewTcdIndex(g,i)}e.set(z.TCS,c.data(z.TCS));e.set(z.TCD,g.data(z.TCD));e.set(z.TCI,g.data(z.TCI)||1)}}var b=x(f,z.ABTEST);if(b&&b.length>0){e.set(z.ABTEST,b.data(z.ABTEST))}e.set(z.RESULT.RESULT,1)
},rebuildTP:function(c){c+="";var d=c.split(E);var a=M("SPM_AREA",d[2]);var b=M("SPM_COM",d[3]);return(d[0]||"0")+E+(d[1]||"0")+E+(a||"0")+E+(b||"0")+E+(d[4]||"0")+E+(d[5]||"0")},rebuildTC:function(c){if(!c){return c}c+="";var a=c.split(E);var b=M("SPM_SYSTEM_TYPE",a[0]||"0");var d=M("SPM_DATA_TYPE",a[2]||"0");return b+E+(a[1]||"0")+E+(d||"0")+E+(a[3]||"0")+E+(a[4]||"1")},getData:function(){var a=this,b=$(a._dom);var n=a.get(z.RESULT.RESULT);if(!n){b.data(z.PC,-1);return null}var l=b.data(z.PC);if(l==1){var e=b.data(z.TP);var c=b.data(z.TC);var h=b.data(z.ABTEST_TAG);var q=K(e,c,h);return q}var j=a.get(z.TPA);var k=a.get(z.TPC);var o=a.get(z.TPI);var r=a.get(z.TCS);var p=a.get(z.TCD);var m=a.get(z.TCI);var c=a.get(z.TC);var i=y+E+G+E+j+E+(k||"0")+E+o+E+B;var f="";if(c){f=c}else{if($.trim(r)!=""||$.trim(p)!=""){if($.trim(r)!=""){f+=r+E
}else{f+="0.0"+E}if($.trim(p)!=""){f+=p+E}else{f+="0.0"+E}f+=m}}f=this.rebuildTC(f);i=this.rebuildTP(i);var d="";var h=a.get(z.ABTEST);if(h){if(h.indexOf(N+E)<0){var g=C(h);if(g){d=A+E+g}}else{d=h}}b.data(z.TP,i);b.data(z.TC,f);b.data(z.ABTEST_TAG,d);b.data(z.PC,1);var q=K(i,f,d);return q},initTpaIndex:function(k){var m=k.data(z.TPA_CHILD_SIZE);var l=this;if(m){return}var g=k.find(l.TAG);m=1;var f={};for(var d=0,h;h=g[d];d++){h=$(h);var j=x(h,z.TPC);if(j.length<1){h.data(z.TPI,m);h.data(z.TPC,0);m++}else{var b=j.find(l.TAG);if(b.length==0){b=j}var a=j.data(z.TPC);var c=f[a]||1;for(var e=0,i;i=b[e];e++){if($(i).data(z.TPI)){continue}$(i).data(z.TPC,a);$(i).data(z.TPI,c);c++}f[a]=c+b.length;j.data(z.TPC_CHILD_SIZE,f[a])}}k.data(z.TPA_CHILD_SIZE,m)},initNewTpaIndex:function(b,d){var e=x(b,z.TPC);
if(e.length<1){var a=d.data(z.TPA_CHILD_SIZE);a++;b.data(z.TPC,0);b.data(z.TPI,a);d.data(z.TPA_CHILD_SIZE,a)}else{var c=e.data(z.TPC_CHILD_SIZE);c++;b.data(z.TPC,e.data(z.TPC));b.data(z.TPI,c);e.data(z.TPC_CHILD_SIZE,c)}},initTcdIndex:function(d){var e=d.data(z.TC_CHILD_SIZE);if(e!=null){return}var a=d.find("[data-tcd]");for(var c=0,b;b=a[c];c++){b=$(b);b.data(z.TCI,c+1)}d.data(z.TC_CHILD_SIZE,a.length)},initNewTcdIndex:function(a,b){var c=b.data(z.TC_CHILD_SIZE);c++;b.data(z.TC_CHILD_SIZE,c);a.data(z.TCI,c)},get:function(a){return this._opt[a]},set:function(a,b){this._opt[a]=b}};function K(i,g,l,n){var i=i||"";var g=g||"";var j="";var k="";var o="";var q="";var d="";var a="";var a="";var h="";var p="";var b="";var m="";var r="";var f="";if(i){var e=i.split(".");if(e.length>=6&&L.isValidUID(e[5])){j=e[2]||"0";
k=e[3]||"0";o=e[4]||"0";b=e[0]||"0";m=e[5]||"0";r=e[1]||"0";if(g){var c=g.split(".");q=c[0]||"0";d=c[1]||"0";a=c[2]||"0";h=c[3]||"0";p=c[4]||"1"}f=l}}if(!f&&n){f=l}return{tp:i,tc:g,tpa:j,tpc:k,tpi:o,tcs:q,tcsa:d,tcd:a,tcdt:h,tci:p,abtestValue:f||"",pageTypeId:y,pageValue:G,unid:B,refPageTypeId:b,refUnid:m,refPageValue:r}}function w(a){if(!a){return null}var b=a.split(E);return b.length==2?b:null}function x(b,a){return b.closest("[data-"+a+"]")}return D});