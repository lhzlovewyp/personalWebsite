define("common_search",["tracker_ref_yhd.global_spm","common_yhd.storage"],function(u,A){var s={};var x=(typeof isSearchKeyWords!="undefined"&&isSearchKeyWords=="1")?1:0;var q=(typeof indexFlag!="undefined"&&indexFlag==1)?1:0;var C=(typeof globalSearchSelectFlag!="undefined"&&globalSearchSelectFlag=="0")?0:1;var y=$("#keyword");var t=$("#searchSuggest");var B=$("#searchBtn");var D=$("#searchBox");var p=window.loli||(window.loli={});var v=p.app=p.app||{};var w=p.app.search=p.app.search||{};var z=URLPrefix.search||"http://search.m.yhd.com";w.delayCall=function(d,g,a,e){var f=$(d);f.lastTime=new Date().getTime();if(g){var c=g.call(f);f.lastResult=c}var b=setTimeout(function(){var h=f.lastTime?f.lastTime:new Date().getTime();var i=(typeof f.lastResult=="undefined"||f.lastResult)?true:false;var j=new Date().getTime();
if(j-h>=(e-50)){if(a&&i){a.call(f)}}},e)};w.filterXml=function(a){if(a!=null&&a!=""){a=a.replace(/\&/g,"");a=a.replace(/\</g,"");a=a.replace(/\>/g,"");a=a.replace(/\\/g,"");a=a.replace(/\'/g,"");a=a.replace(/\"/g,"")}return a};w.saveKeyword=function(b,c){var a=A;if(a){a.getFromRoot("search_keyword_history",function(i){if(i&&i.status==1){var f=i.value;var h=[];var d=[];if(f){h=f.split(",")}for(var e=0;e<h.length;e++){var g=w.filterXml(decodeURIComponent(decodeURIComponent(h[e])));if(g!=null&&g.length>0){d.push(g)}}var j=false;for(var e=0;e<d.length;e++){if(d[e]==b){j=true;break}}if(!j){d.push(b);if(d.length>10){d.shift()}for(var e=0;e<d.length;e++){d[e]=encodeURIComponent(encodeURIComponent(d[e]))}a.setFromRoot("search_keyword_history",d.join(","),function(k){if(k&&k.status==1){if(c){c()}}})
}else{if(c){c()}}}})}if(c){setTimeout(function(){c()},3*1000)}};w.getSearchKeywordUrl=function(a,c,b){if(b){a=a+" "+b}if(!c){c="0";return z+"/search/k"+encodeURIComponent(a)}return z+"/search/c"+c+"-0/k"+encodeURIComponent(a)};w.goSearch=function(c,a,d){var b=function(){var e=w.getSearchKeywordUrl(c,a,d);u.refreshPage(e,D)};w.saveKeyword(c,b)};w.showHistory=function(f,d){if(!C){return}var e=f.val();var c=A;var a=function(){var g=z+"/search/getSmartKeyword/?callback=?";$.getJSON(g,function(j){if(j&&j.hotSearchKeywords&&j.hotSearchKeywords.length>0){var h=[];for(var i=0;i<j.hotSearchKeywords.length;i++){var k=w.filterXml(j.hotSearchKeywords[i]);h.push("<a class='item' href='javascript:goSearch(\""+k+"\")'>"+k+"</a>")}$("div.tags",d).html(h.join(""));$("div.tags",d).show()}if(c){c.getFromRoot("search_keyword_history",function(H){if(H&&H.status==1){var G=H.value;
var m=[];var n=[];if(G){m=G.split(",")}for(var o=m.length-1;o>=0;o--){var l=w.filterXml(decodeURIComponent(decodeURIComponent(m[o])));if(l!=null&&l.length>0){n.push("<li><a class='link_text' href='javascript:goSearch(\""+l+"\")'>");n.push("<span class='icon icon-history'></span>");n.push("<span class='text'>"+l+"</span>");n.push("<span class='icon_arrow icon-right_arrow'></span>");n.push("</a></li>")}}$("ul",d).html(n.join(""));if(m.length==0){d.find("a.clear_history").hide()}else{d.find("a.clear_history").show()}}})}$("#globalHeader").addClass("search_show");b(f,d)})};var b=function(h,g){g.on("click","a.clear_history",function(){c.setFromRoot("search_keyword_history","");$(this).hide();$("ul",g).html("")})};if(e==""||$.trim(e)==""){a()}};w.showSuggest=function(c,a){if(!C){return}var b=w.filterXml(c.val());
var d=function(){var e=z+"/search/getSmartKeyword/?keyword="+encodeURIComponent(b)+"&callback=?";$.getJSON(e,function(f){if(f){var h=[];var k=b;if(f.keywords&&f.keywords.length>0){var g=f.keywords[0];k=f.keywords[0].keyword;h.push("<li>");h.push("<a class='link_text' href='javascript:goSearch(\""+g.keyword+"\")'>");h.push("<span class='icon icon-search'></span>");h.push("<span class='text'>"+g.keyword+"</span>");h.push("</a>");for(var j=0;j<g.attrs.length;j++){h.push("<a class='link_tag' href='javascript:goSearch(\""+g.keyword+'",0,"'+g.attrs[j]+"\")'>"+g.attrs[j]+"</a>")}h.push("</li>")}if(f.recommendCID1&&f.recommendCNA1){h.push("<li><a class='link_text' href='javascript:goSearch(\""+k+'","'+f.recommendCID1+"\")'>");h.push("<span class='icon icon-sort'></span>");h.push("<span class='text_category'>在<strong>"+f.recommendCNA1+"</strong>分类中搜索</span>");
h.push("<span class='icon_arrow icon-right_arrow'></span>");h.push("</li></a>")}if(f.recommendCID2&&f.recommendCNA2){h.push("<li><a class='link_text' href='javascript:goSearch(\""+k+'","'+f.recommendCID2+"\")'>");h.push("<span class='icon icon-sort'></span>");h.push("<span class='text_category'>在<strong>"+f.recommendCNA2+"</strong>分类中搜索</span>");h.push("<span class='icon_arrow icon-right_arrow'></span>");h.push("</li></a>")}if(f.keywords&&f.keywords.length>0){for(var i=1;i<f.keywords.length;i++){var g=f.keywords[i];h.push("<li>");h.push("<a class='link_text' href='javascript:goSearch(\""+g.keyword+"\")'>");h.push("<span class='icon icon-search'></span>");h.push("<span class='text'>"+g.keyword+"</span>");h.push("</a>");for(var j=0;j<g.attrs.length;j++){h.push("<a class='link_tag' href='javascript:goSearch(\""+g.keyword+'",0,"'+g.attrs[j]+"\")'>"+g.attrs[j]+"</a>")
}h.push("</li>")}}$("ul",a).html(h.join(""));$("div.tags",a).hide();a.find("a.clear_history").hide();$("#globalHeader").addClass("search_show")}})};if(b!=""&&$.trim(b)!=""){d()}};w.registerGlobalEvent=function(){var a=function(e,g,c){e=e||window.event;if(e){var d=e.keyCode;if(d=="116"||d=="16"||d=="17"||d=="18"||d=="38"||d=="40"||d=="13"){return}}var f=w.filterXml(g.val());if(f==""||$.trim(f)==""){w.delayCall(g,function(){D.find("span.icon_delete").hide()},function(){w.showHistory(g,c)},200)}else{w.delayCall(g,function(){D.find("span.icon_delete").show()},function(){w.showSuggest(g,c)},200)}};var b=function(d,f,c){var e=w.filterXml(f.val());if(e==""||$.trim(e)==""){w.delayCall(f,null,function(){w.showHistory(f,c)},200)}else{w.delayCall(f,null,function(){w.showSuggest(f,c)},200)}};y.on("focus",function(c){b(c,y,t)
});y.on("input",function(c){a(c,y,t)});B.on("click",function(c){var d=w.filterXml(y.val());if(d!=""&&$.trim(d)!=""){w.goSearch(d)}});$("#searchForm").on("submit",function(){var c=w.filterXml(y.val());if(c!=""&&$.trim(c)!=""){w.goSearch(c)}return false});r()};function r(){D.on("click","span.icon_back",function(){y.val(y.attr("data-original"));D.find("span.icon_delete").hide();$("#globalHeader").removeClass("search_show")});D.on("click","span.icon_delete",function(a){y.val("");D.find("span.icon_delete").hide();y.trigger("focus")});$("#searchMask").on("click",function(){y.val(y.attr("data-original"));D.find("span.icon_delete").hide();$("#globalHeader").removeClass("search_show")})}s.init=function(){if("shop"==globalTopType||"groupShop"==globalTopType){r();y.on("click",function(){$("#globalHeader").addClass("search_show");
t.hide()});return}w.registerGlobalEvent();window.goSearch=function(a,c,b){w.goSearch(a,c,b)}};s.show=function(){var a=w.filterXml(y.val());if(a==""||$.trim(a)==""){w.showHistory(y,t)}else{w.showSuggest(y,t)}};return s});