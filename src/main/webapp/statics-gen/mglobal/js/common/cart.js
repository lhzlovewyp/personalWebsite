define(["global_env","tracker_ref_yhd.global_spm","common_redirect"],function(t,y,s){var w={};var z=t.isInApp();var u="_landingpage";var A=t.getOSType();var r=t.isWireless2();var p=function(){};var B=function(){w.refreshCart()};var x=URLPrefix.index||"http://m.yhd.com";var o=function(a){};var q=function(a,b,c){};var v=function(a,e){if(r){var b={};if(a){var c=y.getData(a,e);if(c){b.tp=c.tp;b.tc=c.tc}}s.gotoWireless2Login(b)}else{var d=globalLoginUrl;if(z){d=x+"/mw/login"}if(t.adapterNewListenner()){y.refreshPage(d,a,e)}else{document.location=d}}};w.addToCart=function(j,l){if(typeof l!="undefined"&&l){if(l.befourAddToCart){p=l.befourAddToCart}if(l.addToCartSuccess){B=l.addToCartSuccess}if(l.addToCartError){o=l.addToCartError}if(l.addToCartServerError){q=l.addToCartServerError}if(l.needLogin){v=l.needLogin
}}if(t.isWireless2()){w.wireless2AddToCart(j);return}var N=j.pmId||0;var P=j.productId||0;var f=j.promotionId||"0";var L=j.promotionId||0;var m=j.promotionLevelId||0;var T=j.merchantId||0;var M=j.needpoint||0;var d=j.productType||0;var h=j.num||1;var O=j.showPrice;var g=j.needTip;var i=j.dom;var b=j.tag;var Q=j.opType||1;if($.trim(f)!=""&&f!="null"&&f!="0"&&!URLPrefix.cart){f=f+"_0"+u}if(typeof f=="undefined"||$.trim(f)==""||f=="null"){f="0";L="0"}if(typeof T=="undefined"||$.trim(T)==""||T=="null"){T="0"}if($.trim(d)!=null&&(d==2||d==1)){var n="";if(A==40){n=websiteurl+"/buypro/"+P+"_"+T+"_1_"+f+"_1";n+="?pmId="+N;document.location=n}else{if(z){s.productDetail(N,P,L||0,i,b)}else{s.productDetail(N,P,L||0,i,b)}}}else{if(z){var n=websiteurl+"/buypro/"+P+"_"+T+"_1_"+f+"_0";n=n+"?pmId="+N;if(t.adapterNewListenner()){y.refreshPage(n,i,b)
}else{document.location=n}}else{if(URLPrefix.cart){var S="";var e={};var a=URLPrefix.cart;if(O){e.showPrice=O}if(g){e.needTip=g}if(f!="0"){S=a+"/cart/addPromotion";e={opTypes:Q,promotionIds:f,promotionLevelIds:m,merchantIds:T,pmids:N,nums:h}}else{if(M>0){S=a+"/cart/addPoint";e={pmId:N,num:h}}else{S=a+"/cart/addNormalPmInfo";e={pmId:N,num:h}}}var c=($.param(e,true));S=S+"?"+c;$.ajax({url:S,dataType:"jsonp",jsonpCallback:"jsonp"+new Date().getTime(),success:function(D){if(D&&D.code!="00000000"){if(D.msg&&D.msg.indexOf("登录")>=0){v(i,b)}else{o(D.msg)}return}if(D&&D.data){var C=D.data;if(D.data instanceof Array&&D.data.length>0){C=D.data[0]}if(C.rtnCode!="000000"){if(C.rtnMsg.indexOf("登录")>=0||C.rtnMsg.indexOf("登陆")>=0){v(i,b)}else{o(C.rtnMsg)}}else{B()}}else{o()}},error:function(D,E,C){q(D,E,C)
}})}else{var R=new Date().getTime();var k="";if(f=="0"){k="/deal/cart/buyproduct/"+N+"/"+h+"?now="+R+"&needpoint="+M}else{k="/deal/cart/buyproduct/"+N+"/"+T+"/"+h+"/"+f+"?now="+R+"&needpoint="+M}if(O){k+="&showPrice="+O}if(g){k+="&needTip="+g}$.ajax({type:"POST",url:k,data:"",dataType:"json",success:function(D){if(D&&D.message){var C=D.message;if(C=="添加购物车成功!"){B()}else{if(C.indexOf("登录")>0||C.indexOf("登陆")>0){v(i,b)}else{o(C)}}}else{o()}}})}}}};w.refreshCart=function(){if(URLPrefix.cart){$.ajax({url:URLPrefix.cart+"/cart/countCart",dataType:"jsonp",jsonpCallback:"jsonp"+new Date().getTime(),success:function(a){if(a&&a.code=="00000000"&&a.data&&a.data.resultData){var b=a.data.resultData.num||0;if(b!="0"){$("#globalCart").html("<i class='sumClass'>"+b+"</i>").show();$("#carId").text(b).show();
$("#globalId").text(b).show()}else{$("#globalCart i").hide();$("#carId").hide();$("#globalId").hide()}}}})}else{$.ajax({type:"POST",url:"/mw/carCounts",success:function(a){if(a){if(a!="0"){$("#globalCart").html("<i class='sumClass'>"+a+"</i>").show();$("#carId").text(a).show();$("#globalId").text(a).show()}else{$("#globalCart i").hide();$("#carId").hide();$("#globalId").hide()}}}})}};w.wireless2AddToCart=function(k){var a=k.pmId||0;var b=k.productId||0;var h=k.promotionId||0;var K=k.merchantId||0;var d=k.productType||0;var j=k.num||1;var l=k.dom;var f=k.tag;var I=1;var n=k.opType;var H=k.promotionLevelId;var L=k.pmIdStr;var J=k.needpoint||0;if($.trim(d)!=null&&(d==2||d==1)){s.productDetail(a,b,h||0,l,f)}else{var g={};if(h&&h!="0"){I=3}else{if(J&&J!="0"){I=2}}g.addType=I+"";if(I==1||I==2){g.pmId=a;
g.num=j+""}else{if(I==3){g.opType=n;g.promotionId=h;g.promotionLevelId=H;g.merchantId=K+"";try{if(!L){var c={};c[a]=parseInt(j);g.pmIdStr=c}else{g.pmIdStr=L}}catch(i){}}}if(l){var m=y.getData(l,f);if(m){g.tp=m.tp;g.tc=m.tc}}var e=h5tonative;if(g&&typeof g!="string"){g=JSON.stringify(g);e.addCart(g)}}};return w});