define(["tracker_ref_yhd.global_spm"],function(D){var B={};var C=$("html"),w=$(".filter_layer"),x=$(".touchweb-com_header"),r=$(".touchweb_com-searchMod"),E=$(".touchweb_components-searchList"),y=$(".pole_layout"),G=x.find(".search_txt"),F=$(".touchweb_components-searchList ul"),u=r.height();var z=URLPrefix.search||"http://m.yhd.com";Array.prototype.unique=function(){var b={};var c=this.length;for(var a=0;a<c;a++){if(typeof b[this[a]]=="undefined"){b[this[a]]=1}}this.length=0;for(var a in b){this[this.length]=a}return this};function A(){v();var a=localStorage.getItem("historykeyword")||"";if(!a){E.removeClass("show");E.find(".clear_history").hide()}else{E.addClass("show");E.find(".clear_history").show()}}function H(){var a=G.val();if(!a){return}$.ajax({url:z+"/search/getkeyword/"+a,dataType:"jsonp",jsonpCallback:"jsonp"+new Date().getTime(),success:function(b){var g="";
if(b!=null&&b!=""){var d=b.split(";");var c=d.length>6?6:d.length;for(var e=0;e<c;e++){var f=d[e].split(",")[0];g+='<li ><a href="javascript:;"><span style="display: inline-block;padding-left: 5px;">'+f+"</span></a></li>"}F.html(g)}else{g+='<li data-result="empt"><a  href="javascript:;"><span style="display: inline-block;padding-left: 5px;"> 没有搜索内容 </span></a></li>';F.html(g)}},error:function(){var b="";b+='<li data-result="empt"><a  href="javascript:;"><span style="display: inline-block;padding-left: 5px;"> 没有搜索内容 </span></a></li>';F.html(b)}})}function v(){var d="",b="";if(!localStorage.getItem("historykeyword")){F.html("");return}else{b=localStorage.getItem("historykeyword").split("|");if(b.length>0){F.empty();var a=b.length>6?6:b.length;for(var c=0;c<a;c++){d+='<li><a class="icon-history"><span style="display: inline-block;padding-left: 5px;">'+b[c]+"</span></a></li>"
}F.html(d)}}}function s(a){var c=localStorage.getItem("historykeyword")||"";var b=[];if(c){b=c.split("|");b=b.reverse()}b[b.length]=a;b=b.reverse();b=b.unique();if(b.length>6){b.length=6}localStorage.setItem("historykeyword",b.join("|"))}function t(b){s(b);var a=(URLPrefix.search||"http://m.yhd.com")+"/search/k"+b;D.refreshPage(a,$("#searchBox"))}B.init=function(){y.css("height",u);G.on("focus",function(){C.addClass("win_lock");r.addClass("show");A()});G.on("input",function(){if(this.value){E.addClass("show");H();E.find(".clear_history").hide()}else{A()}});w.on("click",function(){C.removeClass("win_lock");E.removeClass("show");r.removeClass("show")});E.on("click","li",function(){var a=$(this).text().trim();if(a==="没有搜索内容"){return}x.find(".search_txt").val(a.replace(/(^\s*)|(\s*$)/g,""));s(a);
C.removeClass("win_lock");E.removeClass("show");r.removeClass("show");addTrackPositionToCookie("1","search");t(a)});E.on("click",".clear_history",function(){localStorage.removeItem("historykeyword");E.find("ul").empty();v();E.removeClass("show")});$("#searchForm_id").bind("submit",function(){var a=G.val().replace(/(^\s*)|(\s*$)/g,"");t(a);return false})};return B});