define(["common_yhd.storage","util_globalLogin"],function(k,m){var r=null;var n="http://m.yhd.com/mobile/nearShop/index.do";var q={};function j(){k.getFromRoot("pminfoRay",function(a){if(a&&a.value){var b=JSON.parse(a.value);if(b){var c=o(b);if(c.length>0){p(JSON.stringify(c));return}}}alert("选择商品数量为0，不能结算");document.location=n})}function o(a){var c=[];for(var b=0;b<a.length;b++){if(a[b].num){c.push(a[b])}}return c}var l=function(a){if(a.result==1){j()}else{alert("进入登录");document.location="https://passport.yhd.com/m/login_input.do"}};function p(c){var a="pminfo="+c+"&virtualprovinceid="+r;var b="http://cart.m.yhd.com/cart/fastBuyBatch?mobileBizType=5";var d="http://buy.m.yhd.com/checkout/order.do?mobileBizType=5&fastBuyFlag=1&virtualprovinceid="+r;$.ajax({url:b,dataType:"jsonp",data:a,jsonpCallback:"jsonp"+new Date().getTime(),success:function(e){if(e!=null&&e.code=="00000000"&&e.data&&e.data.rtnCode=="000000"){document.location=d
}else{if(e.data&&e.data.rtnCode!="000000"){alert("业务异常："+e.data.rtnMsg)}else{alert("接口异常："+e.msg)}document.location=n}},error:function(e,f){alert("接口异常");document.location=d}})}q.gotoCheckout=function(a){if(a&&Number(a)){r=a;m.globalCheckLogin(l)}else{alert("参数异常");document.location=n}};return q});