var shareProductId="";var shareMerchantId="";var shareOrderId="";var shareContentgood="";var shareImage_url="";var productname="";var urlPrefix=URLPrefix.central;var urlPrefixComment=URLPrefix.my;function apperarShareSuccess(f,g){if(f.value==-1){yhdPublicLogin.showLoginDivNone(URLPrefix.passport,false,"",function(b){if(b==0){yhdPublicLogin.showTopLoginInfo()}});return}if(f.value==0){var a=jQuery("#ex_prompt");YHD.popwin(a.html(),466,283);return}var h=urlPrefixComment+"/member/exp/showProductExcerienceDiv.do?productId="+g+"&merchantId="+shareMerchantId+"&soId="+shareOrderId+"&callback=?";jQuery.getJSON(h,function(c){if(c.value==null||c.value==""||c.ERROR){}else{YHD.popwin(c.value);YHD.popwin(c.value,jQuery(".popbox").width(),jQuery(".popbox").height());jQuery(".popbox").bgiframe();new Stars("stars1");
var b=jQuery("#experience_info").attr("soid");if(jQuery("#stars_desc").size()>0&&jQuery("#stars_atti").size()>0&&jQuery("#stars_logi").size()>0){new Stars("stars_desc");new Stars("stars_atti");new Stars("stars_logi")}shareMerchantId=jQuery("#experience_info").attr("merchantid");jQuery("[name=experience.submit]").click(function(){shareMerchantId=jQuery("#experience_info").attr("merchantid");deployShareExperience(shareProductId,shareMerchantId,b)})}})}function deployShareExperience(n,v,u,q){shareProductId=n;shareMerchantId=v;var t=/<[^> ]+>/;var x=urlPrefix+"/product/deployExperience.do?productID="+n+"&merchantID="+v+"&action=create&soId="+u;var p=jQuery("#contentTitle").val();if(p&&""!=jQuery.trim(p)){p=p.replace(/(^\s*)|(\s*$)/g,"");if(p.length>15){jQuery("span[id='titleDesc']").html("<em class='r'>*超出15个字的字数限制</em>");
return}if(p.length<5){jQuery("span[id='titleDesc']").html("<em class='r'>*内容不少于5个字</em>");return}if(t.exec(p)){jQuery("span[id='titleDesc']").html("<em class='r'>*请填写评论标题(5-15个字)</em>");return}}else{jQuery("span[id='titleDesc']").html("<em class='r'>*请填写评论标题(5-15个字)</em>");return}jQuery("span[id='titleDesc']").html("<em class='r'>*</em>请填写评论标题(5-15个字)");x=x+"&title="+encodeURIComponent(encodeURIComponent(p));var y=true;var r="#yhd_pop_win .ipt3,#yhd_pop_win .ipt6";if(q&&q=="publishExperience"){r="#publishExperience .ipt3,#publishExperience .ipt6"}jQuery(r).each(function(a){var c=jQuery(this).attr("nullTitile");var b=jQuery(this).attr("categoryTitile");var d=jQuery(this).attr("experienceTitle");var e=jQuery(this).val().replace(/(^\s*)|(\s*$)/g,"");if(e==""){if(b=="contentGood"){jQuery("span[id='contentTitle1Desc']").html("<em class='r'>*请填写评论内容(5-200字)</em>");
y=false;return false}jQuery("span[id='contentTitle1Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)");if(b=="contentFail"){jQuery("span[id='contentTitle2Desc']").html("<em class='r'>*请填写评论内容(5-200字)</em>");y=false;return false}jQuery("span[id='contentTitle2Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)");if(b=="content"){jQuery("span[id='contentTitle3Desc']").html("<em class='r'>*请填写评论内容(5-200字)</em>");y=false;return false}jQuery("span[id='contentTitle3Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)")}if(e.length>200){if(b=="contentGood"){jQuery("span[id='contentTitle1Desc']").html("<em class='r'>*超出200个字的字数限制</em>");y=false;return false}jQuery("span[id='contentTitle1Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)");if(b=="contentFail"){jQuery("span[id='contentTitle2Desc']").html("<em class='r'>*超出200个字的字数限制</em>");
y=false;return false}jQuery("span[id='contentTitle2Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)");if(b=="content"){jQuery("span[id='contentTitle3Desc']").html("<em class='r'>*超出200个字的字数限制</em>");y=false;return false}jQuery("span[id='contentTitle3Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)")}if(e.length<5){if(b=="contentGood"){jQuery("span[id='contentTitle1Desc']").html("<em class='r'>*内容不少于5个字</em>");y=false;return false}jQuery("span[id='contentTitle1Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)");if(b=="contentFail"){jQuery("span[id='contentTitle2Desc']").html("<em class='r'>*内容不少于5个字</em>");y=false;return false}jQuery("span[id='contentTitle2Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)");if(b=="content"){jQuery("span[id='contentTitle3Desc']").html("<em class='r'>*内容不少于5个字</em>");
y=false;return false}jQuery("span[id='contentTitle3Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)")}if(t.exec(e)){if(b=="contentGood"){jQuery("span[id='contentTitle1Desc']").html("<em class='r'>*</em>请填写评论内容(5-200个字)");y=false;return false}jQuery("span[id='contentTitle1Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)");if(b=="contentFail"){jQuery("span[id='contentTitle2Desc']").html("<em class='r'>*</em>请填写评论内容(5-200个字)");y=false;return false}jQuery("span[id='contentTitle2Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)");if(b=="content"){jQuery("span[id='contentTitle3Desc']").html("<em class='r'>*</em>请填写评论内容(5-200个字)");y=false;return false}jQuery("span[id='contentTitle3Desc']").html("<em class='r'>*</em>请填写评论内容(5-200字)")}x=x+"&"+b+"="+encodeURIComponent(encodeURIComponent(e))+"&"+d+"="+encodeURIComponent(encodeURIComponent(c))
});if(y){var o=getStartvalue("#stars1-input");var s=5;var z=5;var w=5;if(jQuery("#stars_logi-input").size()>0&&jQuery("#stars_atti-input").size()>0&&jQuery("#stars_desc-input").size()>0){s=getStartvalue("#stars_logi-input");z=getStartvalue("#stars_atti-input");w=getStartvalue("#stars_desc-input")}jQuery("[name=experience.submit]").css("disabled",true);x=x+"&qualityRating="+o+"&deliveryRating=5&serviceRating=5&mdeliveryPoint="+s+"&mservicePoint="+z+"&mdescriptPoint="+w+"&callback=?";jQuery(".evaBtn").attr("disabled","disabled");jQuery.getJSON(x,function(a){jQuery(".evaBtn").removeAttr("disabled");if(a.ERROR){}else{jQuery(".popwinClose").click();showShareDeployPage(a,q)}});return true}else{return false}}function getStartvalue(f){var e=jQuery(f);var d="5";if(e&&e.val()!=""&&e.val()!=null){d=e.val()
}return d}function showErrorTitle(c,d){jQuery("#"+c).css({color:"#666",display:"inline-block",height:"23px","line-height":"23px",padding:"0 5px",border:"1px solid #FF8080","background-color":"#FFF2F2"});jQuery("#"+c).html(d);setTimeout(function(){jQuery("#"+c).removeAttr("style");jQuery("#"+c).html("")},9000)}function showShareDeployPage(g,k){var l=g.value.split("=");var h=l[0];var i=l[1];if(h==1){jQuery(".popwinClose").click();window.scrollTo(0,0);var j='<div class="popup_cont"><div class="prompted"><img src="'+URLPrefix.statics+'/member/images/okay.png"/><h3>提交成功！ </h3><p>'+i+'!</p></div><p class="countdown">3秒后自动关闭</p><a href="javascript:void(0);" class="close">关闭</a></div>';popMsg(j,".popup_cont .close",378,120);if(jQuery("#categoryAllProducts")&&jQuery("#categoryAllProducts").size()>0){loadExpInfo(1)
}if(jQuery("#noCommentProductsView")&&jQuery("#noCommentProductsView").size()>0){loadNoCommentProductInfo()}if(jQuery("#myOrderList")&&jQuery("#myOrderList").size()>0){orderListPageInfo(1)}setTimeout(function(){jQuery(".popup_cont .close").click();openShare();if(k&&k=="publishExperience"){jQuery("#contentTitle").attr("value","");jQuery(".ipt3, .ipt6").each(function(a){jQuery(this).attr("value","")})}},3000)}else{if(h==2){var j='<div class="popup_sens"><h3 class="title">提示<span class="close">关闭</span></h3><p class="popup_text">'+i+'</p><p class="btntip"><input type="button" value="确 定" /></p></div>';popMsg(j,".popup_sens .close,.btntip :button",398,150,250);jQuery(".popup_sens .close,.btntip :button").click(function(){openShare()});if(jQuery("#categoryAllProducts")&&jQuery("#categoryAllProducts").size()>0){loadExpInfo(1)
}if(jQuery("#noCommentProductsView")&&jQuery("#noCommentProductsView").size()>0){loadNoCommentProductInfo()}if(jQuery("#myOrderList")&&jQuery("#myOrderList").size()>0){orderListPageInfo(1)}if(k&&k=="publishExperience"){jQuery("#contentTitle").attr("value","");jQuery(".ipt3, .ipt6").each(function(a){jQuery(this).attr("value","")})}}else{var j='<div class="popup_sens"><h3 class="title">提示<span class="close">关闭</span></h3><p class="popup_text">'+i+'</p><p class="btntip"><input type="button" value="确 定" /></p></div>';popMsg(j,".popup_sens .close,.btntip :button",398,150);if(k&&k=="publishExperience"){jQuery("#contentTitle").attr("value","");jQuery(".ipt3, .ipt6").each(function(a){jQuery(this).attr("value","")})}}}}function popMsg(l,i,k,g,j){YHD.init();var h=jQuery("#yhd_pop_win");if(l!=null){jQuery(h).html(l)
}if(j){YHD.initPosition(h,k,g,j)}else{YHD.initPosition(h,k,g)}jQuery(h).jqm({overlay:10,overlayClass:"pop_win_bg",modal:true,toTop:true}).jqmShow().jqmAddClose(i)}function appearAndShareExperience(n,m,j,l,h){productname=h;var k=jQuery.cookie("ut");if(!k){yhdPublicLogin.showLoginDivNone(URLPrefix.passport,false,"",function(a){if(a==0){yhdPublicLogin.showTopLoginInfo()}});return}else{executiveLandedCheck();shareImage_url=l;shareProductId=n;if(m!=null&&m!=0&&j!=null&&j!=0){shareOrderId=j;shareMerchantId=m}else{j=null;m=null}var i=urlPrefix+"/product/checkItemCount.do?productID="+n+"&merchantId="+shareMerchantId+"&soId="+shareOrderId+"&callback=?";jQuery.getJSON(i,function(a){if(a.ERROR){}else{apperarShareSuccess(a,n)}})}}function openShare(){jQuery("#pop_win_ok_btn").click();var b=urlPrefixComment+"/member/exp/editShareExcerienceDiv.do?productId="+shareProductId+"&callback=?";
jQuery.getJSON(b,function(a){if(a.ERROR){}else{if(a.value!="noshare"){getSinaUrl(function(f){YHD.popwin(a.value,470,400);jQuery("[name=experience.cancel]").click(function(){jQuery(".popwinClose").click()});if(shareImage_url==""||productname==""||shareImage_url==null||productname==null){try{shareImage_url=jQuery("#mainPic").attr("tag");productname=jQuery("#productMainName").text()}catch(e){}}jQuery("[name='product_image']").attr("src",shareImage_url);shareContentgood="我在1号店买了【"+productname.substring(0,110)+"】 ";jQuery("[name='product_share_experience']").val(shareContentgood+f);jQuery("[name=experience.share]").click(function(){if(jQuery("[name='product_share_experience']").val().length>140){jQuery("#shareErrorMsg").html("<p>分享内容不能超过140字</p>")}else{if(jQuery("[name='product_share_experience']").val().length==0){jQuery("#shareErrorMsg").html("<p>分享内容不能为空</p>")
}else{var c=false;jQuery(":checkbox[name^='share_to_']").each(function(d){c=c||jQuery(this).attr("checked")});if(c){perpShareExcerience(shareProductId)}else{jQuery("#shareErrorMsg").html("<p>请选择分享平台</p>")}}}})})}}})}var sinaUrl="";function getSinaUrl(b){if(sinaUrl!=""){b(sinaUrl)}else{getShotURL("sina",b)}}function getShotURL(d,c){if(d=="sina"&&sinaUrl!=""){c(sinaUrl)}else{url=URLPrefix.passport+"/share/shotUrl.do?longUrl="+escape(URLPrefix.central+"/product/"+shareProductId+"?tarcker_u="+getpcode(d))+"&callback=?";jQuery.getJSON(url,function(a){c(a.shotUrl);if(d=="sina"){sinaUrl=a.shotUrl}})}}function getpcode(b){if("sina"==b){return"1047513694"}if("qq"==b){return"1057943695"}if("kaixin"==b){return"1095733696"}if("renren"==b){return"1020853697"}}var shareMsg="";var sig="";var exid="";function perpShareExcerience(b){shareMsg=encodeURIComponent(encodeURIComponent(jQuery("[name='product_share_experience']").val()));
sig=jQuery("#shareErrorMsg").attr("sign");exid=jQuery("#shareErrorMsg").attr("exid");validateShare(b,"sina");validateShare(b,"renren");validateShare(b,"qq");validateShare(b,"kaixin");jQuery(".popwinClose").click();YHD.alert("评论并且分享成功",null,476,27)}function validateShare(d,c){if(jQuery(":checkbox[name='share_to_"+c+"']")&&jQuery(":checkbox[name='share_to_"+c+"']").attr("checked")){shareExcerience(d,c)}}function createShareUrl(f,e,h){var g=URLPrefix.passport+"/share/"+e+"/publish.do?sign="+sig+"&exid="+exid+"&productId="+shareProductId+"&pubMessage.content="+shareMsg+"&pubMessage.title="+encodeURIComponent(encodeURIComponent("在一号店发布了购买体验"))+"&pubMessage.image="+escape(shareImage_url)+"&pubMessage.url="+escape(h)+"&sinaUrl="+escape(sinaUrl)+"&callback=?";return g}function shareExcerience(d,c){getShotURL(c,function(a){jQuery.getJSON(createShareUrl(d,c,a),function(b){})
})};