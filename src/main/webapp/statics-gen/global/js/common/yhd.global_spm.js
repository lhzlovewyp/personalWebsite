(function(u){var G=".";var x="0";var D="1";var A={TPA:"data-tpa",TPC:"data-tpc",TPI:"tpi",TCS:"data-tcs",TCD:"data-tcd",TCI:"data-tci",PC:"data-pc",TP:"data-tp",TC:"data-tc",TCE:"data-tce",ABTEST:"data-abtest",EXPR_TAG:"a,area,button",TPA_CHILD_SIZE:"data-tpaChildSize",TPC_CHILD_SIZE:"data-tpcChildSize",TC_CHILD_SIZE:"data-tcChildSize",RESULT:{RESULT:"result",TP:"tp",TC:"tc",UNIID:"uniId",PAGETYPE:"pageType",PAGEID:"pageId"}};var z=null,t=null,v=0;var C=window.loli||(window.loli={});var H=C.global.uid;var F={getData:function(a){if(C.isSpider()){return{}}E();if(v==-1||v==2){return null}var b=new w(a);return b.getData()},getNewPageData:function(){E();var h=C.util.url.getParams(location.href)||{};var b=h.tp;var f=h.tc;var e=h.tce;var a=h.abtest;var j=h.ti;var g=h.tps;var c=0;var i=B();if(i&&i.length>0){a=x+G+i;
c=1}var d={tp:b,tc:f,tce:e,abtest:a,unValidAB:c,ti:j,tps:g};return y(d)},reloadPage:function(a){var b=r(window.location.href,a);window.location.href=b},refreshPage:function(c,a){var b=r(c,a);window.location.href=b},openPage:function(d,g,a,e){var f=r(g,d);var c="";if(typeof(a)!="undefined"&&a){c=a}var b="";if(typeof(e)!="undefined"&&e){b=e}window.open(f,c,b)},getABExpParam:function(b){var a="";if(b){a=C.page.getABExpParam(b)}return a}};function r(h,b){if(typeof(h)=="undefined"||!h){return""}var j=typeof(b);if(j=="undefined"||!b){return h}var g=null;if(j=="string"){var i=b;var m=b.indexOf("#");if(m==-1){i="#"+i}g=u(i)}else{if(j=="object"){g=b}}if(!g){return h}var f=C.spm.getData(g);if(f){var l=f.tp;var d=f.tc;var c=f.tce;var k=f.abtestValue;var e={tp:l,tc:d,tce:c,abtest:k};var a=C.util.url.appendParams(h,e);
return a}else{return h}}function E(){var a=u("meta[name=tp_page]").attr("content");a=C.page.checkTpPage(a);if(!a){v=-1;return}z=encodeURI(C.page.glSpmcodeToId(null,a[0]));t=encodeURI(a[1]);if(z&&z=="0"){v=2}}function B(){var a=u("meta[name=global-abtest]");if(a&&a.length>0){return a.attr("content")}return""}function w(a){var b=this;b._dom=a;b._opt={};b.init()}w.prototype={init:function(){var f=this,g=f._dom;if(!g){f.set(A.RESULT.RESULT,0);return}if(!(g instanceof u)){g=u(g)}var e=g.data(A.PC);if(e==1){f.set(A.RESULT.RESULT,1);return}else{if(e==-1){f.set(A.RESULT.RESULT,0);return}}var a=s(g,A.TPA);if(a.length<1){if(z){f.set(A.RESULT.RESULT,1);f.set(A.TPA,0);f.set(A.TPC,0);f.set(A.TPI,0)}else{f.set(A.RESULT.RESULT,0)}return}f.set(A.TPA,a.attr(A.TPA));f.initTpaIndex(a);var b=g.data(A.TPI);if(!b){f.initNewTpaIndex(g,a)
}f.set(A.TPC,g.data(A.TPC));f.set(A.TPI,g.data(A.TPI));var i=s(g,A.TC);if(i&&i.length>0){f.set(A.TC,i.attr(A.TC))}else{f.initTcdIndex(a);var d=s(g,A.TCS);var h=s(g,A.TCD);if(h.length>0){if(!d.attr(A.TCD)){f.initNewTcdIndex(h,a)}f.set(A.TCS,d.attr(A.TCS));f.set(A.TCD,h.attr(A.TCD));f.set(A.TCI,h.data(A.TCI)||1)}}var c=s(g,A.ABTEST);if(c&&c.length>0){f.set(A.ABTEST,c.attr(A.ABTEST))}f.set(A.RESULT.RESULT,1)},rebuildTP:function(c){var d=c.split(G);var a=C.page.glSpmcodeToId("SPM_AREA",d[2]);var b=C.page.glSpmcodeToId("SPM_COM",d[3]);return(d[0]||"0")+G+(d[1]||"0")+G+(a||"0")+G+(b||"0")+G+(d[4]||"0")+G+(d[5]||"0")},rebuildTC:function(c){if(!c){return c}var a=c.split(G);var b=C.page.glSpmcodeToId("SPM_SYSTEM_TYPE",a[0]||"0");var d=C.page.glSpmcodeToId("SPM_DATA_TYPE",a[2]||"0");return b+G+(a[1]||"0")+G+(d||"0")+G+(a[3]||"0")+G+(a[4]||"1")
},rebuildABTest:function(a){return C.page.glABcodeToTag(a)},getData:function(){var a=this,b=u(a._dom);var j=a.get(A.RESULT.RESULT);if(!j){b.data(A.PC,-1);return null}var c=b.data(A.PC);var f="";var n=s(b,A.TCE);if(n&&n.length>0){f=n.attr(A.TCE)}if(c==1){var e=b.data(A.TP);var N=b.data(A.TC);var k=b.data(A.ABTEST);var m={tp:e,tc:N,tce:f,abtest:k};var g=y(m);return g}var p=a.get(A.TPA);var q=a.get(A.TPC);var o=a.get(A.TPI);var O=a.get(A.TCS);var h=a.get(A.TCD);var i=a.get(A.TCI);var N=a.get(A.TC);var M=z+G+t+G+p+G+q+G+o+G+H;var d="";if(N){d=N}else{if(u.trim(O)!=""||u.trim(h)!=""){if(u.trim(O)!=""){d+=O+G}else{d+="0.0"+G}if(u.trim(h)!=""){d+=h+G}else{d+="0.0"+G}d+=i}}M=this.rebuildTP(M);d=this.rebuildTC(d);var P="";var k=a.get(A.ABTEST);if(k){if(k.indexOf(x+G)<0){var l=this.rebuildABTest(k);if(l){P=D+G+l
}}else{P=k}}b.data(A.TP,M);b.data(A.TC,d);b.data(A.ABTEST,P);b.data(A.PC,1);var m={tp:M,tc:d,tce:f,abtest:P};var g=y(m);return g},initTpaIndex:function(k){var m=k.data(A.TPA_CHILD_SIZE);if(m){return}var h=k.find(A.EXPR_TAG);m=1;var g={};for(var e=0,i;i=h[e];e++){i=u(i);var j=s(i,A.TPC);var l=i.data(A.TPI);if(j.length<1){if(!l){i.data(A.TPI,m)}i.data(A.TPC,0);m++}else{var b=j.find(A.EXPR_TAG);if(b.length==0){b=j}var c=j.attr(A.TPC);var d=g[c]||1;for(var f=0,a;a=b[f];f++){u(a).data(A.TPC,c);if(u(a).data(A.TPI)){continue}u(a).data(A.TPI,d);d++}g[c]=d;j.data(A.TPC_CHILD_SIZE,g[c])}}k.data(A.TPA_CHILD_SIZE,m)},initNewTpaIndex:function(a,d){var e=s(a,A.TPC);var c=a.data(A.TPI);if(e.length<1){var f=d.data(A.TPA_CHILD_SIZE);f++;a.data(A.TPC,0);if(!c){a.data(A.TPI,f)}d.data(A.TPA_CHILD_SIZE,f)}else{var b=e.data(A.TPC_CHILD_SIZE)||0;
b++;a.data(A.TPC,e.attr(A.TPC));if(!c){a.data(A.TPI,b)}e.data(A.TPC_CHILD_SIZE,b)}},initTcdIndex:function(e){var a=e.data(A.TC_CHILD_SIZE);if(a!=null){return}var b=e.find("[data-tcd]");for(var d=0,c;c=b[d];d++){c=u(c);c.data(A.TCI,d+1)}e.data(A.TC_CHILD_SIZE,b.length)},initNewTcdIndex:function(a,b){var c=b.data(A.TC_CHILD_SIZE);c++;b.data(A.TC_CHILD_SIZE,c);a.data(A.TCI,c)},get:function(a){return this._opt[a]},set:function(a,b){this._opt[a]=b}};function y(f){var n=f.tce,l=f.abtest,d=f.unValidAB,Z=f.ti,j=f.tps;var ad=f.tp||"";var aj=f.tc||"";var ao="";var ah="";var p="";var ab="";var an="";var h="";var ac="";var b="";var al="";var e="";var af="";var ap="";var ag="";var o="";if(ad){ad=decodeURIComponent(ad);var g=ad.split(".");if(g.length>=6&&C.config.isValidUID(g[5])){ao=g[2]||"0";ah=g[3]||"0";
p=g[4]||"0";al=g[0]||"0";e=g[5]||"0";af=g[1]||"0";if(aj){var am=aj.split(".");ab=am[0]||"0";an=am[1]||"0";h=am[2]||"0";ac=am[3]||"0";b=am[4]||"1"}ap=l;if(Z){var ak=g[5].split("-")[0];var ae=ak+"_"+Z;var ai=u.cookie(ae);if(ai){var c=ai.split(";");if(c){for(var k=0;k<c.length;k++){var a=c[k];if(a&&a.indexOf(":")>0){var m=a.split(":");var aa=m[0];var q=m[1];if(aa=="x"){ag=q}else{if(aa=="y"){o=q}}}}}u.cookie(ae,"",{expires:-1,path:"/",domain:no3wUrl})}}else{if(j&&j.indexOf("x")==0&&j.indexOf("y")>1&&j.indexOf("y")!=j.length-1){var i=j.indexOf("y");ag=j.substring(1,i);o=j.substring(i+1)}}}}if(!ap&&d){ap=l}return{tp:ad,tc:aj,tpa:ao,tpc:ah,tpi:p,tcs:ab,tcsa:an,tcd:h,tcdt:ac,tci:b,tce:n||"",abtestValue:ap||"",pageTypeId:z,pageValue:t,unid:H,refPageTypeId:al,refUnid:e,refPageValue:af,eventXRate:ag,eventYRate:o}
}function s(b,a){return b.closest("["+a+"]")}C.spm=F})(jQuery);