(function(e){var f=function(b){var c=b,a={lazyImg:{ltime:"2000",lnum:"5",load:true,indexLoad:false,scrollLoad:true,attr:"original",wideAttr:null,hfix:100}};e.extend(a,c);this.param=a};f.prototype={constructor:f,isBusy:false,doc:document,imgArray:[],wideAttr:null,lazyImg:function(j,l){var k=this,b=k.param.lazyImg,a,c=j;if(l){k.param.lazyImg=e.extend(b,l)}if(c instanceof e){a=c}else{if(e.isArray(c)){c=e(c.join(","))}else{c=e(c)||e("body")}}if(b.wideAttr){wideAttr=b.wideAttr;k.imgArray=c.find("img["+b.attr+"],img["+wideAttr+"]")}else{k.imgArray=c.find("img["+b.attr+"]")}if(b.indexLoad){k._lazyImg(k.imgArray,b)}if(b.scrollLoad){k._iniLazy(function(){if(k.imgArray.length==0){return a}k._lazyImg(k.imgArray,b)})}if(b.load){k._loadImg(c)}return j},_loadImg:function(b){var j=this,k=j.param.lazyImg,l=k.attr,a=k.ltime,c=k.lnum;
(function(g,r,p,q,h){var i=setInterval(function(){if(g.isBusy){return false}var m=g.imgArray;var n=m.length;if(n>h){g._imgLoad(m,0,h,p)}else{if(n>0){g._imgLoad(m,0,n,p)}else{clearInterval(i)}}},q)})(j,b,l,a,c)},_lazyImg:function(a,o){var c=o.attr,l=a.length,m=this,n=0,b=1;m.isBusy=true;var p=m._pageTop();m._imgLoad(m.imgArray,n,l,c,p,o.hfix);m.isBusy=false},_imgLoad:function(a,u,q,c,r,p){var s=this;if(r){for(var b=u;b<q;b++){var v=e(a[b]);var i=jQuery(window).height()+p;if(v.offset().top<(r+p)&&(r-v.offset().top)<i){s._renderImg(v,c);delete a[b]}}}else{for(var b=u;b<q;b++){var v=e(a[b]);s._renderImg(v,c);delete a[b]}}var t=new Array();for(var b=0;b<a.length;b++){if(a[b]!=null){t.push(a[b])}}s.imgArray=t},_renderImg:function(c,a){var b=c;if(typeof wideAttr!="undefined"&&wideAttr!=null&&b.attr(wideAttr)){b.attr("src",loli.webp(b.attr(wideAttr)));
b.removeAttr(a)}else{b.attr("src",loli.webp(b.attr(a)));b.removeAttr(a)}},_iniLazy:function(b){var a=this;loli.delay(window,"scroll",function(){if(!a.isBusy){a.isBusy=true;return true}else{return false}},function(){b()},50)},_pageTop:function(){var b=this,c=b.doc,a=c.documentElement;return a.clientHeight+Math.max(a.scrollTop,c.body.scrollTop)},_hashImgUrl:function(a){if(loli&&loli.util){return loli.util.hashImgUrl(a)}return a}};var d=new f();e.fn.extend({lazyImg:function(a){var b=new f();return b.lazyImg(this,a)}})})(jQuery);