(function(a){a(function(){var e=a.cookie("provinceId");var g=a.cookie("yihaodian_uid");var i=(typeof globalTopPrismFlag!="undefined"&&globalTopPrismFlag=="0")?0:1;if(!g||!e||!i){return}var j=window.loli||(window.loli={});var f=0;var d=[];var h={};if(a("#glShouCangChild").size()==0){return}var b=typeof URLPrefix.my!="undefined"?URLPrefix.my:"http://my.yhd.com";j.globalCheckLogin(c);function c(o){if(!o||!o.result||o.result!=1){return}var l=b+"/member/myNewFavorite/myUserFavoriteInfo.do?callback=?";var p={favoriteType:0};a.getJSON(l,p,function(s){var q=s;if(q){if(q.code==0){var r=q.resultList;m(r)}else{}}});function m(s){if(!s||s.length<1){return}var q=[];for(var t=0;t<s.length;t++){var r=s[t];if(!r.price||!r.listPrice){continue}q.push(r);h[r.pmInfoId]=r}k(q)}function k(u){if(!u||u.length<1){return
}var x=[];var s=-1;for(var r=0;r<u.length;r++){var q=u[r];if(r%10==0){s=s+1;if(!x[s]){x[s]=[]}x[s].push(q.pmInfoId)}else{x[s].push(q.pmInfoId)}}f=x.length;for(var w=0;w<f;w++){n(x[w])}var v=setInterval(function(){if(f<=0){var y=d.length;clearInterval(v);var M=a("#glShouCangChild");var t=[];t.push('<em style="width: 86px;"></em>');t.push("<dl>");var I=[];var K=0;for(var N=0;N<y;N++){var J=d[N];if(J==null||J.pmInfoId==null||J.productId==null||!J.isPromotion||!J.promotionInfo||J.promotionInfo.length<1){continue}K++;var E=J.promotionInfo[0];var F=h[J.pmInfoId];z="pms_191_prism_fav_pro_p_"+F.pmInfoId;var C="http://item.yhd.com/item/"+F.pmInfoId;var G=yhdToolKit.getProductPicByDefaultPic(F.productUrl,60,60);I.push("<dd>");I.push('<a class="hd_pro_img" data-tpc="21" href="'+C+'" data-ref="'+z+'" target="_blank"><img src="'+j.util.hashImgUrl(G)+'"></a>');
I.push('<a class="hd_pro_name" data-tpc="22" href="'+C+'" data-ref="'+z+'" target="_blank">'+F.productName+"</a>");I.push('<p class="hd_pro_price">¥'+F.price+"</p>");if(E.type==2||E.type==3){var D="http://list.yhd.com/p/c0-b-a-s1-v0-p1-price-d0-pid"+F.productId+"-pt"+E.promotionId+"-pl"+E.levelId+"-m0";var z="pms_191_prism_fav_pro_l_"+E.promotionId;I.push('<p class="hd_sale_tips"><i></i><a data-tpc="23" href="'+D+'" data-ref="'+z+'" target="_blank">'+E.promDesc+"</a></p>")}else{I.push('<p class="hd_sale_tips"><i></i><a>'+E.promDesc+"</a></p>")}I.push("</dd>")}if(K>0){t.push("<dt>您收藏的商品中有<b>"+K+"</b>个商品正在促销</dt>")}else{return}t.push(I.join(" "));t.push("</dl>");var H="http://my.yhd.com/member/myNewCollection/myFavorite.do?operType=0";var A="http://my.yhd.com/member/myNewCollection/myFavorite.do?operType=1";
t.push('<div class="hd_btn_wrap clearfix"><a data-tpc="24" href="'+H+'" data-ref="global_prism_fav_pro_more" target="_blank">我收藏的商品</a><a data-tpc="25" href="'+A+'"  data-ref="global_prism_fav_shop_more" target="_blank">我收藏的店铺</a></div>');M.html(t.join(" "));M.removeClass("hd_menu_list").addClass("hd_favorites");var B=a("#glShouCang").find(".hd_menu");var L=B.find("span");L.html(L.html().replace(/&nbsp;/g,""));B.html(B.html()+'<u class="hd_fav_num">'+K+"</u>")}},1000)}function n(t){var r="";for(var q=0;q<t.length;q++){if(t[q]==""||t[q]<=0){continue}r+="&pmInfoIds="+t[q]}if(!r){return}var v=URLPrefix.central+"/homepage/ajaxFindProductPromotions.do?callback=?";var s={mcsiteId:1,pmInfoIds:t.join(","),provinceId:e};var u=0;jQuery.getJSON(v,s,function(w){if(u==1){return}u=1;f--;if(!w||w.status!=1){return true
}d=d.concat(w.result)});setTimeout(function(){if(u=0){u=1;f--}},2000)}}})})(jQuery);