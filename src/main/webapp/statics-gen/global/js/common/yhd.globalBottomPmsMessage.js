(function(b){b(function(){var v=YHDOBJECT.globalVariable().globalPageCode;var z=b.cookie("provinceId");if(typeof(v)=="undefined"||v==-1){return}if(!z){return}if(jQuery("#globalBottomBrowseRelated").length<1){return}var r={currSiteId:currSiteId,currSiteType:1,provinceId:z,pageCode:v,pmid:b("#productMercantId").val(),merchantId:b("#merchantId").val(),userid:b.cookie("yihaodian_uid"),showWideScreen:(typeof isWidescreen!="undefined"&&isWidescreen==true)?true:false,showBigWideScreen:(typeof isBigWidescreen!="undefined"&&isBigWidescreen==true)?true:false};var x=function(c){p("#globalBottomBrowseRelated",function(){t(c)})};var t=function(c){a(c);B()};var a=function(c){b.extend(r,c)};var B=function(){var e=URLPrefix.pms+"/pms/bottomRec.do?";urlStr=[];urlStr.push(e);for(var d in r){var c=r[d];if(c){urlStr.push(d+"="+r[d]+"&")
}}urlStr.push("callback=?");b.getJSON(urlStr.join(""),function(f){if(f){var g=f.value[0];if(g&&g&&g.status==1){y(g)}}})};var y=function(m){var Y=b("#globalBottomBrowseRelated");if(Y.length<1){return}var aa=[];var X=[];var Q=m.lTrackerPrefix;var ad=m.rTrackerPrefix;var f=m.sourceObject;var l=m.productList;var d=m.exposureCode;var i=m.promTrackerPrefix;var Z=m.guideTrackerPrefix;aa.push('<div class="browse_related">');aa.push('<div class="clearfix">');aa.push('<div class="browse_related_left" id="browseHistory">');aa.push("<h4>浏览记录</h4>");aa.push('<div class="paging">');var h=f.length;var V=l.length;totalSize=parseInt((h-1)/4)+1;aa.push('<a class="prev" href="javascript:void(0);"></a><em><b class="cur_page">1</b>/<span>'+totalSize+'</span></em><a class="next" href="javascript:void(0);"></a>');
aa.push("</div>");aa.push('<div class="paging_wrap browse_history_wrap">');aa.push('<ul class="browse_history_con clearfix" style="margin-left: 0px;">');var g;if(h<1){g="猜你喜欢的商品";aa.push('<li><div class="browse_history_none"><dt>尚未浏览商品</dt><dd></dd></div></li>')}else{g="与您浏览记录相关的商品";for(var ab=0;ab<totalSize;ab++){aa.push("<li>");var R=(ab+1)*4<h?(ab+1)*4:h;for(var T=ab*4;T<R;T++){var k=f[T];var ac=k.samMemberPrice?1:0;X.push(k.pmId);aa.push('<div class="browse_history_list">');aa.push('<a href="'+k.linkUrl+'" target="_blank" class="pro_img" data-ref="'+Q+"_"+k.productId+"_"+T+'"><img src="'+q.util.hashImgUrl(k.picUrl)+'"></a>');aa.push("<div>");aa.push('<a title="'+k.cnName+'" href="'+k.linkUrl+'" target="_blank" data-ref="'+Q+"_"+k.productId+"_"+T+'">'+k.cnName+"</a>");if(ac){aa.push('<p class="sam_price" data-productId="'+k.pmId+'" data-samFlag="1"><b>¥'+k.samMemberPrice+'</b><em class="sam_icon"></em></p>')
}else{aa.push('<p data-productId="'+k.pmId+'"><b>¥'+k.salePrice+"</b></p>")}aa.push("</div>");aa.push("</div>")}aa.push("</li>")}}aa.push("</ul>");aa.push("</div>");aa.push("</div>");aa.push('<div class="browse_related_right">');aa.push("<h4>"+g+"</h4>");aa.push('<div class="browse_related_list" id="alsoBuyBox">');aa.push('<a href="javascript:;" class="prev">上一页</a>');aa.push('<div class="paging_wrap slide_box">');aa.push('<ul class="clearfix" style="margin-left: 0px;">');for(var ab=0;ab<V;ab++){var k=l[ab];var ac=k.samMemberPrice?1:0;X.push(k.pmId);aa.push('<li class="">');aa.push('<a class="pic" title="'+k.cnName+'" href="'+k.linkUrl+'" target="_blank" data-ref="'+ad+"_"+k.productId+"_"+ab+'"><img src="'+q.util.hashImgUrl(k.picUrl)+'"></a>');aa.push('<a title="'+k.cnName+'" href="'+k.linkUrl+'" target="_blank" class="pro_name" data-ref="'+ad+"_"+k.productId+"_"+ab+'">'+k.cnName+"</a>");
if(!ac){aa.push('<p class="price" data-productId="'+k.pmId+'"><strong>¥'+k.salePrice+"</strong></p>")}else{aa.push('<p class="price sam_price" data-productId="'+k.pmId+'" data-samFlag="1"><strong>¥'+k.samMemberPrice+"</strong><em></em></p>")}var o=k.promotions;if(o&&o.length>0){var U=o[0];aa.push('<p class="prolist_link"><a target="_blank" href="'+U.linkUrl+'" title="'+U.name+'" data-ref="'+i+"_"+k.productId+"_"+U.id+'">'+U.name+"</a></p>")}else{aa.push('<p class="prolist_link"><a></a></p>')}if(k.buttonType==2&&!ac){var W=2;if(k.pmId){W=k.pmId}aa.push('<p class="glbtn"><a onclick="gotracker('+W+",'"+ad+"Btn_"+ab+"','"+k.productId+"');addToCart(event,'"+k.productId+"','"+k.merchantId+"','"+k.shoppingCount+"',false,'"+ad+"Btn_0');\">加入购物车</a></p>")}else{aa.push('<p class="glbtn"><a href="'+k.linkUrl+'" target="_blank" data-ref="'+ad+"_"+k.productId+"_"+ab+'">查看详情</a></p>')
}aa.push('<div class="pro_label clearfix">');var c=k.guideProperties;var j=c.length;if(c&&j>0){for(var T=0;T<j;T++){var n=c[T];var S=Z+"_"+k.productId+"_"+n.id;aa.push('<span><a target="_blank" href="'+n.linkUrl+'" title="'+n.name+'" data-ref="'+S+'">'+n.name+"</a></span>")}}aa.push("</div>");aa.push("</li>")}aa.push("</ul>");aa.push("</div>");aa.push('<a href="javascript:;" class="next" style="display: block;">下一页</a>');var e;if(r.showBigWideScreen){e=parseInt((V-1)/6)+1}else{if(r.showWideScreen){e=parseInt((V-1)/5)+1}else{e=parseInt((V-1)/4)+1}}aa.push('<em class="page_num"><i class="cur_page">1</i>/<span>'+e+"</span></em>");aa.push("</div></div></div></div>");Y.html(aa.join(""));Y.addClass("browse_related_wrap mt");w.loadFun(Y);gotracker("2",d);u(X)};var u=function(e){var c="";var h=URLPrefix.busystock?URLPrefix.busystock:"http://gps.yhd.com";
if(e.length<1){return}for(var f=0;f<e.length;f++){c+="&pmIds="+e[f]}try{var g=h+"/restful/promotion?mcsite="+currSiteId+"&provinceId="+z+c+"&callback=?";jQuery.getJSON(g,function(i){if(!i||i.ERROR){return}jQuery.each(i,function(l,j){var m=jQuery("#globalBottomBrowseRelated p[data-productId='"+j.pmId+"']");if(m&&m.attr("data-samFlag")!="1"){var k="¥"+j.price;m.find("b").text(k);m.find("strong").text(k)}})})}catch(d){}};var p=function(e,c){var f=jQuery(e).offset().top;if(s()<f){var d=function(){if(s()>=jQuery(e).offset().top){c();b(window).unbind("scroll",d)}};b(window).bind("scroll",d)}else{c()}};var s=function(){var c=document,g=c.documentElement,d=c.body,f=Math.max(g.scrollTop,d.scrollTop),e=g.clientHeight+f;return e};var w={browseRelatedHover:function(){var c=b("#globalBottomBrowseRelated").find(".browse_related_list .slide_box");
c.delegate("li","mouseover",function(){b(this).addClass("cur").siblings("li").removeClass("cur")});c.delegate("li","mouseout",function(){c.find("li").removeClass("cur")})},bottomRecmdSlide:function(f,k){var f=b(f),l=f.find(".prev"),h=f.find(".next"),d=f.find(".cur_page"),i=f.find("ul"),j=i.find("li"),o=Math.ceil(f.find(".paging_wrap").width()/j.outerWidth(true)),e=Math.ceil(j.length/o),m=j.outerWidth(true)*o,g=0,n=f.find(".turn").find("span"),c;if(e>1){h.addClass("next_clickable")}f.delegate(".next_clickable","click",function(){g++;c(g)});f.delegate(".prev_clickable","click",function(){g--;c(g)});f.delegate(".turn span","click",function(){var E=b(this),F=E.index();if(!E.hasClass("cur")){c(F)}});c=function(D){d.text(D+1);n.removeClass("cur");n.eq(D).addClass("cur");if(D==0){l.removeClass("prev_clickable");
h.addClass("next_clickable")}else{if(D==(e-1)){l.addClass("prev_clickable");h.removeClass("next_clickable")}else{l.addClass("prev_clickable");h.addClass("next_clickable")}}i.animate({marginLeft:-m*D},k)}},loadFun:function(){w.browseRelatedHover();w.bottomRecmdSlide("#browseHistory",500);w.bottomRecmdSlide("#alsoBuyBox",500)}};var q=window.loli||(window.loli={});q.app=q.app||{};var A=q.app.pms=q.app.pms||{};A.loadBottomBrowseRelated=x;A.loadBottomBrowseRelated()})})(jQuery);