(function(c){var d=function(a){var g=a,b=URLPrefix.busystock?URLPrefix.busystock:"http://gps.yhd.com",h="/busystock/restful/truestock";_setting={attr:"productid",busystock_url:b+h,busystockAttr:"productIds",lazyLoadDelay:500,priceCounter:30,load:true,maxNum:200,oneOffLoad:false,indexLoad:false,scrollLoad:true,hfix:100,callbackHtml:null};c.extend(_setting,g);this.param=_setting};d.prototype={constructor:d,isBusy:false,doc:document,priceArray:[],lazyPrice:function(b,o){var p=this,l=p.param;if(o){p.param=c.extend(l,o)}var k=b,m=l.attr,n=l.busystock_url,a=l.maxNum;if(k instanceof c){p.priceArray=b.find("["+m+"]").get()}else{if(c.isArray(k)){p.priceArray=k}else{p.priceArray=c(b).find("["+m+"]").get()}}if(l.oneOffLoad){p._flushPrice(p.priceArray,m,n,l.busystockAttr,a);return b}if(l.indexLoad){p._lazyPrice(p.imgArray,l)
}if(l.scrollLoad){p._iniLazy(function(){if(p.priceArray.length==0){return b}p._lazyPrice(p.priceArray,l)})}if(l.load){p._loadPrice()}return b},_loadPrice:function(){var o=this,b=o.param,k=b.attr,p=b.busystock_url,m=b.busystockAttr,l=b.maxNum,a=b.lazyLoadDelay,n=b.priceCounter;(function(s,e,t,j,h,f,i){var g=setInterval(function(){if(s.isBusy){return false}var r=s.priceArray;var q=r.length;if(q>i){s._priceLoad(r,e,t,j,0,i,h)}else{if(q>0){s._priceLoad(r,e,t,j,0,q,h)}else{clearInterval(g)}}},f)})(o,k,p,m,l,a,n)},_lazyPrice:function(m,o){var n=o.attr,t=m.length,q=o.busystock_url,r=o.busystockAttr,p=o.maxNum,b=this,a=0;b.isBusy=true;var s=b._pageTop()+o.hfix;b._priceLoad(m,n,q,r,a,t,p,s);b.isBusy=false},_priceLoad:function(r,s,b,t,z,w,v,A){var B=this,a=r.length;if(a==0){return}var x=new Array();if(A){for(var u=z;
u<w;u++){var i=c(r[u]);if(i.offset().top<A){x.push(i);delete r[u]}}}else{for(var u=z;u<w;u++){var i=c(r[u]);x.push(i);delete r[u]}}B._flushPrice(x,s,b,t,v);var y=new Array();for(var u=0;u<r.length;u++){if(r[u]!=null){y.push(r[u])}}B.priceArray=y},_iniLazy:function(b){var a=this;window.scrollTo(0,0);c(window).bind("scroll",function(){if(!a.isBusy){b()}else{}})},_pageTop:function(){var b=this,f=b.doc,a=f.documentElement;return a.clientHeight+Math.max(a.scrollTop,f.body.scrollTop)},_flushPrice:function(L,H,I,j,E){var F=this,b=F.param,G=b.callbackHtml;if(L&&L.length>0){var J=L.length,e=0,a,y=1;if(J<E){a=J}else{y=(J-1)/E+1}var z=jQuery.cookie("provinceId");if(!z){return}var C="?mcsite="+currBsSiteId+"&provinceId="+z;var A={};for(var D=0;D<y;D++){if(D>0){e=E*D;a=e+E;if(a>J){a=J}}A={};for(var B=e;
B<a;B++){var K=jQuery(L[B]);C+="&"+j+"="+K.attr(H);if(!A[K.attr(H)]){A[K.attr(H)]=[]}A[K.attr(H)].push(K)}try{jQuery.getJSON(I+C+"&callback=?",function(f){if(f==null||f==""){return}jQuery.each(f,function(h,g){var k=A[g.productId];if(k){jQuery.each(k,function(l,m){if(G){jQuery(m).html(G(g,m)).removeAttr(H)}else{if(currSiteId==2){jQuery(m).text("¥"+g.productPrice).removeAttr(H)}else{if(k){if(globalShowMarketPrice==1){var n="<strong>¥"+g.productPrice+"</strong>";n+="<del>¥"+g.marketPrice+"</del>";jQuery(m).html(n).removeAttr(H)}else{var n="<strong>¥"+g.productPrice+"</strong>";if(g.curPriceType&&g.curPriceType==2&&g.yhdPrice){n+="<del>¥"+g.yhdPrice+"</del>"}jQuery(m).html(n).removeAttr(H)}}}}})}})})}catch(i){}}}}};c.fn.extend({lazyPrice:function(a){var b=new d();return b.lazyPrice(this,a)}})})(jQuery);