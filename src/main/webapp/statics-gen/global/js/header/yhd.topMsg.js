(function(a){a(function(){var b=window.loli||(window.loli={});var u=b.app=b.app||{};var f=b.app.msg=b.app.msg||{};var n=a.cookie("provinceId");var e=a.cookie("yihaodian_uid");var o=(typeof o=="undefined")?1:o;var k=1;var w=a("#hdUserMsg");var l=w.size()>0?w.attr("data-cfg"):0;if(!e||!n||!l){return}var q=function(y){var x=new Date();x.setTime(y);var z=x.getMonth()+1;var A=x.getDate();return z+"月"+A+"日"};var v=function(x){if(x!=null&&x!=""){x=x.replace(/\&/g,"&amp;");x=x.replace(/\</g,"&lt;");x=x.replace(/\>/g,"&gt;");x=x.replace(/\\/g,"&#92;");x=x.replace(/\'/g,"&#039;");x=x.replace(/\"/g,"&#034;")}return x};var c=function(y){var z=URLPrefix.central+"/homepage/ajaxFindUserMsgsNum.do?callback=?";var x={userId:e,currSiteId:o,currSiteType:k,provinceId:n};a.getJSON(z,x,function(A){if(A&&A.status==1){y(A.value)
}else{y(0)}})};var g=function(z){var x="http://webim.yhd.com/customer/offline.action";var y=function(B){var C=0;if(!isNaN(B)){C=parseInt(B)}if(C>0){z(C)}else{z(0)}};var A={userId:e,currSiteId:o,currSiteType:k,provinceId:n};a.ajax({url:x,data:A,dataType:"jsonp",jsonp:"jsonpCallback",success:function(B){if(B){y(B)}else{y(0)}}})};var r=function(y){var z=URLPrefix.central+"/homepage/ajaxFindUserMsgs.do?callback=?";var x={userId:e,currSiteId:o,currSiteType:k,provinceId:n};a.getJSON(z,x,function(A){if(A&&A.status==1){y(A.value)}else{y(null)}})};var j=function(z,x){var y=URLPrefix.central+"/homepage/ajaxUpdateUserMsgsStatus.do?callback=?";var A={userId:e,msgIds:z.join(","),currSiteId:o,currSiteType:k,provinceId:n};a.getJSON(y,A,function(B){if(B&&B.status==1){x(B.value)}else{x(null)}})};var m=function(D,x){var z="http://edm.yhd.com/pcMsg/myMessage.action";
var B="http://webim.yhd.com/global/frontCheckPoint.action";var E=[];if(D==0&&(!x||x.length==0)){E.push("<div class='hd_none_notice'>");E.push("<span class='hd_none_pic'></span>");E.push("<p>无新消息</p>");E.push("</div>");return E.join("")}if(x&&x.length>0){E.push("<p class='hd_ntc_top clearfix' data-tpc='1'>");E.push("<a class='fl' href='javascript:;'>全部标记为已读</a>");E.push("<a class='blue_link fr' href='"+z+"' target='_blank'>查看更多</a>");E.push("</p>")}E.push("<div class='hd_notice_detail'>");if(D>0){E.push("<div class='hd_service clearfix' data-tpc='2'>");E.push("<span class='fl'><i></i>客服消息</span>");E.push("<a class='fr hd_delete_notc' href='javascript:;'>×</a>");E.push("<a class='fr hd_notc_num' href='"+B+"' target='_blank'><u>"+D+"</u>条新消息</a>");E.push("</div>")}if(x&&x.length>0){E.push("<div class='hd_notice_list' data-tpc='3'>");
for(var y=0;y<x.length;y++){var C=x[y];var A=C.link?C.link:"javascript:;";E.push("<dl data-msgId='"+C.msgId+"'>");E.push("<dt class='clearfix'>");E.push("<b class='fl'>"+C.title+"</b>");E.push("<a class='fr hd_delete_notc' href='javascript:;'>×</a>");E.push("<em class='fr'>"+q(C.createTime)+"</em>");E.push("</dt>");E.push("<dd>");E.push("<a class='hd_notice_txt' href='"+A+"'"+(C.link?" target='_blank'>":">")+v(C.content)+"</a>");E.push("</dd>");E.push("</dl>")}E.push("</div>")}E.push("</div>");return E.join("")};var h=function(){var x=w.data("customerMsgsNum")!=null?w.data("customerMsgsNum"):0;var z=w.data("userMsgsNum")!=null?w.data("userMsgsNum"):0;var y=x+z;if(y>0){w.find("a.hd_notice_tit").html("<i></i>新消息(<span>"+(y>=100?"99+":y)+"</span>)");w.addClass("hd_has_notice")}else{w.find("a.hd_notice_tit").html("<i></i>新消息(<span>0</span>)");
w.removeClass("hd_has_notice")}};var t=function(){var A=0;var B=0;var x=null;var y=function(C){B=C;w.data("userMsgsNum",B);w.show();h();s()};var z=function(C){if(x){clearTimeout(x)}A=C;w.data("customerMsgsNum",A);c(y)};g(z);x=setTimeout(function(){w.data("customerMsgsNum",0);c(y)},1500)};var d=function(){var x=w.data("customerMsgsNum")!=null?w.data("customerMsgsNum"):0;var z=w.data("userMsgsNum")!=null?w.data("userMsgsNum"):0;var y=function(A){if(A&&A.length>0){z=A.length}else{z=0}w.data("userMsgsNum",z);h();var B=m(x,A);w.find("div.hd_notice").html(B);w.addClass("hd_notice_hover")};r(y)};var p=function(){var x=[];var y=w.find("div.hd_notice_list dl");y.each(function(){x.push(a(this).attr("data-msgId"))});j(x,function(A){if(A){var z=m(0,null);w.find("div.hd_notice").html(z);w.data("userMsgsNum",0);
w.data("customerMsgsNum",0);w.find("a.hd_notice_tit").html("<i></i>新消息(<span>0</span>)");w.removeClass("hd_has_notice")}})};var i=function(y){var z=[];z.push(y);var x=w.find("div.hd_notice_list dl[data-msgId='"+y+"']");j(z,function(A){if(A){d()}})};var s=function(){var x,y;w.mouseenter(function(){if(y){clearTimeout(y)}x=setTimeout(function(){if(w.data("loaded")){w.addClass("hd_notice_hover");return}w.data("loaded",1);d()},200)});w.mouseleave(function(){if(x){clearTimeout(x)}y=setTimeout(function(){w.removeClass("hd_notice_hover")},200)});w.delegate("p.hd_ntc_top a.fl","click",function(){p()});w.delegate("div.hd_notice_list a.hd_delete_notc","click",function(){var z=a(this).parents("dl").attr("data-msgId");i(z)});w.delegate("div.hd_service a.hd_delete_notc","click",function(){w.data("customerMsgsNum",0);
d()});w.delegate(".hd_notice_list dl","mouseenter",function(){a(this).addClass("hd_notc_cur")});w.delegate(".hd_notice_list dl","mouseleave",function(){a(this).removeClass("hd_notc_cur")});w.delegate(".hd_notice_detail","mousewheel",function(C,A){var D=a(".hd_notice_detail",w).scrollTop();var B=a(".hd_notice_detail",w).outerHeight();var z=(a(".hd_service",w).outerHeight()?a(".hd_service",w).outerHeight():0)+a(".hd_notice_list",w).outerHeight()-1;if(B>z){C.preventDefault()}if(D==z-B&&(A<0)){C.preventDefault()}})};f.showMsgsNum=function(){if(w.size()>0){b.globalCheckLogin(function(x){if(x&&x.result==1){t()}})}};f.showMsgs=function(){if(w.size()>0){b.globalCheckLogin(function(x){if(x&&x.result==1){d()}})}};window.topMsgTimeoutHandler=setTimeout(function(){f.showMsgsNum()},1*1000)})})(jQuery);