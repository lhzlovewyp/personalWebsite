(function(b){b(function(){var R=window.loli||(window.loli={});var z=R.app=R.app||{};var G=R.app.order=R.app.order||{};var a=R.yhdStore;var F=b.cookie("provinceId");var O=b.cookie("yihaodian_uid");var N="top_prism_order";var E="top_prism_order_num_"+O;var C=(typeof globalTopPrismFlag!="undefined"&&globalTopPrismFlag=="0")?0:1;var Q=b("#hdPrismWrap");var H=b("#hdPrismOrder");var L=b("#hdPrismOrderNum");var M=b("#hdPrismOrderList");if(!O||!F||!C){return}var B=function(){if(a){var c=a.isIE();if(c==0||c>=9||(c==8&&a.isRoot())){a.getFromRoot(E,function(d){if(d&&d.status==1){var e=(d.value&&!isNaN(d.value))?parseInt(d.value):0;H.data("ordersNumData",e);if(e>0){L.text(e<=99?e:99);L.show()}else{if(isNaN(d.value)||d.value==null){I()}}}else{I()}})}else{I()}}};var I=function(){var c=URLPrefix.central+"/homepage/ajaxFindTopPrismOrdersNum.do?callback=?";
var e=function(f){H.data("ordersNumData",f);H.data("ordersNumLoaded",1);if(f>0){L.text(f<=99?f:99);L.show()}else{L.text("");L.hide()}if(a){a.setFromRoot(E,f)}};var d={userId:O,currSiteId:(typeof currSiteId=="undefined")?1:currSiteId,currSiteType:1,provinceId:F};b.getJSON(c,d,function(f){var g=f;if(g){if(g.status==1){var h=g.result;e(h)}}})};var y=function(){var e=URLPrefix.central+"/homepage/ajaxFindTopPrismOrders.do?callback=?";var c=function(g){H.data("ordersData",g);var f=x(g);M.removeClass("global_loading").html(f);M.height("auto")};var d={userId:O,currSiteId:(typeof currSiteId=="undefined")?1:currSiteId,currSiteType:1,provinceId:F};b.getJSON(e,d,function(f){var g=f;if(g){if(g.status==1){var h=g.orders;c(h)}}})};var x=function(aa){var e="http://image.yihaodianimg.com/front-homepage/global/images/defaultproduct_60x60.jpg";
var p=typeof URLPrefix.my!="undefined"?URLPrefix.my:"http://my.yhd.com";var f="http://my.yhd.com/order/myOrder.do";var c="http://cms.yhd.com/cmsPage/show.do?pageId=65818";var g=[];if(aa&&aa.length>0){g.push("<p class='hd_order_tips'><a class='blue_link' href='"+c+"' target='_blank' data-ref='"+N+"_download'>下载手机客户端，轻松查询配送信息</a></p>");for(var v=0;v<aa.length;v++){var Y=aa[v];var j=Y.status;var s=Y.actionType;var o=s==1?"待付款":(s==2?"待收货":(s==3?"待评论":""));var m=p+"/order/orderDetail.do?orderCode="+Y.code;var n=N+"_detail_"+Y.id;var u="http://e.yhd.com/front-pe/pe/orderProductExperience!orderProductExperience.do?soId="+Y.id+"&userId="+O+"&hasCommented=false&soType=0";var q=N+"_comment_"+Y.id;var l="http://my.yhd.com/order/finishOrder.do?orderCode="+Y.code;var r=N+"_pay_"+Y.id;var d="http://e.yhd.com/front-pe/couriers/deliveryStaff!comment.do?soId="+Y.id;
var w=N+"_commentExpress_"+Y.id;if(!Y.hasSubOrders){g.push("<div class='hd_order_list'>");g.push("<a href='"+m+"' target='_blank' data-ref='"+n+"' class='hd_order_num'>");if(s==3&&!Y.deliveryMsg){var ad=J(j);if(ad){g.push("<b><i></i>"+ad+"</b>")}}g.push("订单号："+Y.code);g.push("</a>");if(Y.deliveryMsg){g.push("<p class='hd_order_status'>"+Y.deliveryMsg+"</p>")}g.push("<div class='hd_pro_list'>");g.push("<div class='clearfix'>");for(var Z=0;Z<Y.items.length;Z++){var ac="http://item-home.yhd.com/item/snapshotShow.do?productId="+Y.items[Z].productId+"&soItemId="+Y.items[Z].soItemId+"&flag=1";var i=P(Y.items[Z].productPicPath?Y.items[Z].productPicPath:e);var h=N+"_item_"+Y.items[Z].productMerchantId;if(Z>2){break}g.push("<a href='"+ac+"' target='_blank' data-ref='"+h+"'><img src='"+R.util.hashImgUrl(i)+"' /></a>")
}g.push("</div>");g.push("</div>");if(s==1){g.push("<div class='hd_btn_wrap'><a href='"+l+"' target='_blank' data-ref='"+r+"' class='hd_pay_btn'>立即支付</a></div>")}else{if(s==3){if(1==Y.hasCommentExpress){g.push("<div class='hd_btn_wrap'>")}else{g.push("<div class='hd_btn_wrap hd_shop_order'>")}g.push("<a href='"+u+"' target='_blank' data-ref='"+q+"' class='hd_comment_btn'>立即评论");if(0==Y.hasCommentGiftActivity){if(1==Y.commentActivityType){g.push("<em class='hd_gift_icon'></em>")}else{if(2==Y.commentActivityType){g.push("<em class='hd_fanxian_icon'></em>")}}}g.push("</a>");if(1==Y.hasCommentExpress){g.push("<a class='hd_comment_express' href='"+d+"' target='_blank' data-ref='"+w+"'>评论快递小哥</a>")}g.push("</div>")}}g.push("</div>")}else{u="http://e.yhd.com/front-pe/pe/orderProductExperience!orderProductExperience.do?soId="+Y.id+"&userId="+O+"&hasCommented=false&soType=1";
g.push("<div class='hd_order_list'>");g.push("<a href='"+m+"' target='_blank' data-ref='"+n+"' class='hd_order_num'>订单号："+Y.code+"</a>");for(var ab=0;ab<Y.subOrders.length;ab++){var t=Y.subOrders[ab];var k="";if(t.deliveryMsg){k=t.deliveryMsg}if(s==3&&!t.deliveryMsg){k=J(t.status)}d="http://e.yhd.com/front-pe/couriers/deliveryStaff!comment.do?soId="+t.id;w=N+"_commentExpress_"+t.id;g.push("<p class='hd_order_status'><i>包裹"+(ab+1)+"</i>"+k+"</p>");g.push("<div class='hd_pro_list'>");g.push("<div class='clearfix'>");for(var Z=0;Z<t.items.length;Z++){var ac="http://item-home.yhd.com/item/snapshotShow.do?productId="+t.items[Z].productId+"&soItemId="+t.items[Z].soItemId+"&flag=1";var i=P(t.items[Z].productPicPath?t.items[Z].productPicPath:e);var h=N+"_item_"+t.items[Z].productMerchantId;if(Z>2){break
}g.push("<a href='"+ac+"' target='_blank' title='"+t.items[Z].productName+"' data-ref='"+h+"'><img src='"+R.util.hashImgUrl(i)+"' title='"+t.items[Z].productName+"'/></a>")}g.push("</div>");if(1==t.hasCommentExpress){g.push("<div class='hd_subbtn_wrap'>");g.push("<a class='hd_comment_express' href='"+d+"' target='_blank' data-ref='"+w+"'>评论快递小哥</a>");g.push("</div>")}g.push("</div>")}if(s==1){g.push("<div class='hd_btn_wrap'><a href='"+l+"' target='_blank' data-ref='"+r+"' class='hd_pay_btn'>立即支付</a></div>")}else{if(s==3){g.push("<div class='hd_btn_wrap hd_shop_order'>");g.push("<a href='"+u+"' target='_blank' data-ref='"+q+"' class='hd_comment_btn'>立即评论</a>");if(0==Y.hasCommentGiftActivity){if(1==Y.commentActivityType){g.push("<em class='hd_gift_icon'></em>")}else{if(2==Y.commentActivityType){g.push("<em class='hd_fanxian_icon'></em>")
}}}g.push("</div>")}}g.push("</div>")}}g.push("<a class='hd_more_btn' href='"+f+"' target='_blank' data-ref='"+N+"_more'>查看更多</a>")}else{g.push("<div class='hd_none_tips'>");g.push("<span class='hd_none_icon'></span>");g.push("<p class='hd_none_text'>您还没有订单哦~</p>");g.push("</div>")}return g.join("")};var P=function(c){if(c){c=c.replace("_40x40.","_60x60.")}return c};var J=function(d){var c="";if(d==20){c="已出库"}else{if(d==24){c="已收货"}else{if(d==35){c="已完成"}}}return c};var A=function(){var c=b("a.hd_prism_tab",H);c.attr("href","javascript:void(0);");c.removeAttr("target");c.click(function(){if(H.data("dataLoaded")=="1"&&H.hasClass("hd_cur")){K(H);return}if(!H.data("ordersNumLoaded")){I()}var d=function(e){if(e.result==1){if(H.data("dataLoaded")=="1"){D(H)}else{H.data("dataLoaded","1");M.height("100");
D(H);y();if(c.data("clicked")!=1){gotracker("2",N);c.data("clicked",1)}}}else{if(yhdPublicLogin){yhdPublicLogin.showLoginDiv()}}};R.globalCheckLogin(d)});b(document.body).click(function(g){var e=b(this);var d=g.target?g.target:g.srcElement;if(d){var f=b(d).parents("div.hd_prism_wrap").size();if(f==0&&H.hasClass("hd_cur")){H.removeClass("hd_cur")}}})};var D=function(c){Q.find("div.hd_prism,div.hd_mini_cart").removeClass("hd_cur");c.addClass("hd_cur")};var K=function(c){c.removeClass("hd_cur")};G.showNum=function(){B();A()};window.topOrderTimeoutHandler=setTimeout(function(){if(H.size()>0){G.showNum()}},3*1000)})})(jQuery);